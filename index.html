<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeBomb - Gestionnaire de Parties</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #3b82f6 0%, #ef4444 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .subtitle {
            color: #cbd5e0;
            font-size: 0.9rem;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== √âCRAN PRINCIPAL ===== */
        .main-menu {
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: center;
            align-items: center;
            flex: 1;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(90deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(90deg, #7c8590 0%, #5a6473 100%);
        }

        .btn-danger {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6);
        }

        .btn-success {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        /* ===== √âCRAN CR√âATION DE PARTIE ===== */
        .create-game {
            gap: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        label {
            font-weight: 600;
            color: #cbd5e0;
            font-size: 0.95rem;
        }

        input[type="text"],
        input[type="number"],
        select {
            padding: 12px;
            border: 2px solid #4b5563;
            border-radius: 6px;
            background: #0f3460;
            color: #fff;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .players-section {
            background: rgba(59, 130, 246, 0.1);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #3b82f6;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }

        .player-item {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .player-item input {
            flex: 1;
        }

        .btn-remove {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .team-config {
            background: rgba(239, 68, 68, 0.1);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #ef4444;
            margin: 15px 0;
        }

        .team-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .team-row label {
            margin: 0;
            flex: 0 0 150px;
        }

        .team-row input {
            flex: 1;
            min-width: 100px;
            max-width: 150px;
        }

        .randomize-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .randomize-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* ===== √âCRAN R√âV√âLATION R√îLES ===== */
        .reveal-screen {
            gap: 30px;
            justify-content: center;
            align-items: center;
        }

        .reveal-card {
            width: 280px;
            height: 380px;
            perspective: 1000px;
            cursor: pointer;
            margin: 0 auto;
        }

        .reveal-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .reveal-card.flipped .reveal-card-inner {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            font-weight: bold;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .card-front {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 3px solid #fbbf24;
            font-size: 2rem;
            color: #fbbf24;
        }

        .card-back.blue {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            transform: rotateY(180deg);
        }

        .card-back.red {
            background: linear-gradient(135deg, #ef4444 0%, #991b1b 100%);
            transform: rotateY(180deg);
        }

        .card-back {
            font-size: 1.5rem;
            flex-direction: column;
            gap: 15px;
        }

        .card-role {
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .card-player {
            font-size: 1.3rem;
            opacity: 0.9;
        }

        .card-team {
            font-size: 1rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .reveal-counter {
            text-align: center;
            font-size: 0.95rem;
            color: #cbd5e0;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* ===== √âCRAN R√âSULTAT ===== */
        .result-screen {
            gap: 20px;
        }

        .result-container {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 25px;
            margin: 15px 0;
        }

        .result-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .team-badge {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .team-badge.blue {
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid #3b82f6;
            color: #60a5fa;
        }

        .team-badge.red {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: #f87171;
        }

        .team-badge h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .team-members {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .winner-banner {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .loser-banner {
            background: linear-gradient(90deg, #6b7280 0%, #4b5563 100%);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 20px 0;
        }

        /* ===== √âCRAN STATS ===== */
        .stats-screen {
            gap: 25px;
        }

        .stat-card {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
        }

        .stat-card h3 {
            margin-bottom: 15px;
            color: #60a5fa;
            font-size: 1.1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            align-items: center;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-name {
            flex: 1;
        }

        .stat-value {
            font-weight: bold;
            color: #fbbf24;
            text-align: right;
            min-width: 100px;
        }

        .stat-bars {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .stat-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .stat-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%);
            width: 0;
            transition: width 0.5s ease;
        }

        .no-games {
            text-align: center;
            padding: 40px;
            color: #cbd5e0;
            font-size: 1.1rem;
        }

        .game-history {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .game-item {
            background: rgba(59, 130, 246, 0.15);
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-item.blue-win {
            border-left-color: #3b82f6;
        }

        .game-item.red-win {
            border-left-color: #ef4444;
        }

        .game-number {
            font-weight: bold;
            color: #fbbf24;
            margin-right: 10px;
        }

        .game-winner {
            color: #10b981;
            font-weight: bold;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 600px) {
            .logo {
                font-size: 1.8rem;
                letter-spacing: 2px;
            }

            .result-group {
                grid-template-columns: 1fr;
            }

            .team-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .team-row label {
                flex: 1 0 100%;
            }

            .team-row input {
                width: 100%;
            }

            .nav-buttons {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .reveal-card {
                width: 100%;
                max-width: 250px;
                height: 340px;
            }
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(75, 85, 99, 0.8);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .back-button:hover {
            background: rgba(75, 85, 99, 1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">‚è∞ TimeBomb</div>
            <div class="subtitle">Gestionnaire de Parties</div>
        </header>

        <!-- ===== MENU PRINCIPAL ===== -->
        <div id="mainMenu" class="screen active main-menu">
            <div class="btn-group">
                <button class="btn-primary" onclick="switchScreen('createGame')">
                    üéÆ Nouvelle Partie
                </button>
                <button class="btn-secondary" onclick="switchScreen('stats')">
                    üìä Statistiques
                </button>
                <button class="btn-danger" onclick="clearAllData()" style="margin-top: 20px;">
                    üóëÔ∏è R√©initialiser les Donn√©es
                </button>
            </div>
        </div>

        <!-- ===== CR√âATION DE PARTIE ===== -->
        <div id="createGame" class="screen create-game">
            <button class="back-button" onclick="switchScreen('mainMenu')">‚Üê Retour</button>
            
            <h2 style="text-align: center; margin: 20px 0;">Cr√©er une Nouvelle Partie</h2>

            <div class="players-section">
                <h3 style="margin-bottom: 15px;">üë• Joueurs</h3>
                <div id="playersList" class="players-list"></div>
                <button class="btn-primary btn-small" onclick="addPlayerInput()" style="width: 100%; margin-top: 10px;">
                    + Ajouter un Joueur
                </button>
            </div>

            <div class="team-config">
                <h3 style="margin-bottom: 15px;">üéØ Configuration des √âquipes</h3>
                <div class="team-row">
                    <label>Bleus (Sherlock):</label>
                    <input type="number" id="blueCount" min="0" max="8" value="3" onchange="updateRandomizeState()">
                    <span style="color: #cbd5e0;">joueurs</span>
                </div>
                <div class="team-row">
                    <label>Rouges (Moriarty):</label>
                    <input type="number" id="redCount" min="0" max="8" value="2" onchange="updateRandomizeState()">
                    <span style="color: #cbd5e0;">joueurs</span>
                </div>

                <div class="randomize-checkbox">
                    <input type="checkbox" id="randomizeTeams" checked>
                    <label for="randomizeTeams" style="margin: 0;">Attribuer al√©atoirement les √©quipes</label>
                </div>

                <div id="manualTeamConfig" style="display: none;">
                    <h4 style="color: #cbd5e0; margin: 15px 0 10px 0;">Attribution manuelle:</h4>
                    <div id="manualTeamInputs"></div>
                </div>
            </div>

            <div class="form-group">
                <button class="btn-success" onclick="startGame()" style="width: 100%; padding: 15px; font-size: 1.1rem;">
                    üöÄ D√©marrer la Partie
                </button>
            </div>
        </div>

        <!-- ===== R√âV√âLATION DES R√îLES ===== -->
        <div id="revealScreen" class="screen reveal-screen">
            <button class="back-button" onclick="switchScreen('mainMenu')">‚Üê Retour</button>

            <div style="text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: center;">
                <h2 style="margin-bottom: 30px;">Cliquez sur la carte pour r√©v√©ler le r√¥le</h2>

                <div class="reveal-card" id="revealCard" onclick="revealRole()">
                    <div class="reveal-card-inner">
                        <div class="card-face card-front">
                            üîí Cliquez ici
                        </div>
                        <div class="card-face card-back" id="cardBack">
                            <div class="card-role" id="cardRole">?</div>
                            <div class="card-player" id="cardPlayer">Joueur</div>
                            <div class="card-team" id="cardTeam">√âQUIPE</div>
                        </div>
                    </div>
                </div>

                <div class="reveal-counter" style="margin-top: 30px;">
                    Joueur <span id="currentPlayer">1</span> sur <span id="totalPlayers">5</span>
                </div>

                <div class="nav-buttons">
                    <button class="btn-secondary" onclick="previousRole()">‚Üê Pr√©c√©dent</button>
                    <button class="btn-secondary" onclick="nextRole()">Suivant ‚Üí</button>
                    <button class="btn-success" onclick="startResult()">‚úì Terminer les R√¥les</button>
                </div>
            </div>
        </div>

        <!-- ===== √âCRAN R√âSULTAT ===== -->
        <div id="resultScreen" class="screen result-screen">
            <button class="back-button" onclick="switchScreen('mainMenu')">‚Üê Retour</button>

            <h2 style="text-align: center; margin: 20px 0;">R√©sultat de la Partie</h2>

            <div class="result-container">
                <h3 style="margin-bottom: 20px;">Qui a gagn√©?</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-success" onclick="setWinner('blue')" style="flex: 1; min-width: 200px;">
                        üîµ √âquipe Sherlock (BLEUS)
                    </button>
                    <button class="btn-danger" onclick="setWinner('red')" style="flex: 1; min-width: 200px;">
                        üî¥ √âquipe Moriarty (ROUGES)
                    </button>
                </div>
            </div>

            <div id="teamRevealResult" style="display: none;">
                <div class="result-group" id="resultTeams"></div>

                <div id="winnerBanner"></div>

                <div class="nav-buttons" style="justify-content: center;">
                    <button class="btn-success" onclick="finishGame()">‚úì Valider & Retour</button>
                    <button class="btn-secondary" onclick="switchScreen('mainMenu')">‚Üê Menu Principal</button>
                </div>
            </div>
        </div>

        <!-- ===== √âCRAN STATISTIQUES ===== -->
        <div id="stats" class="screen stats-screen">
            <button class="back-button" onclick="switchScreen('mainMenu')">‚Üê Retour</button>

            <h2 style="text-align: center; margin: 20px 0;">üìä Statistiques des Joueurs</h2>

            <div id="statsContent"></div>
        </div>
    </div>

    <script>
        // ===== DONN√âES =====
        let gameData = {
            players: [],
            games: []
        };

        let currentGame = {
            players: [],
            teams: {
                blue: [],
                red: []
            },
            result: null,
            winner: null,
            gameNumber: 0
        };

        // ===== LOCALSTORAGE =====
        function saveData() {
            localStorage.setItem('timebombData', JSON.stringify(gameData));
        }

        function loadData() {
            const saved = localStorage.getItem('timebombData');
            if (saved) {
                gameData = JSON.parse(saved);
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir r√©initialiser TOUTES les donn√©es?\nCette action est irr√©versible.')) {
                gameData = { players: [], games: [] };
                saveData();
                switchScreen('mainMenu');
            }
        }

        // ===== NAVIGATION =====
        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');

            if (screenId === 'stats') {
                renderStats();
            }
        }

        // ===== CR√âATION DE PARTIE =====
        function addPlayerInput() {
            const list = document.getElementById('playersList');
            const div = document.createElement('div');
            div.className = 'player-item';
            div.innerHTML = `
                <input type="text" placeholder="Nom du joueur" class="player-input">
                <button class="btn-remove" onclick="this.parentElement.remove()">‚úï</button>
            `;
            list.appendChild(div);
            list.lastChild.querySelector('input').focus();
        }

        function initializePlayers() {
            const inputs = document.querySelectorAll('.player-input');
            const list = document.getElementById('playersList');
            
            if (list.children.length === 0) {
                // Initialisation avec joueurs vides
                for (let i = 0; i < 5; i++) {
                    addPlayerInput();
                }
            }
        }

        function updateRandomizeState() {
            const randomize = document.getElementById('randomizeTeams').checked;
            const manualConfig = document.getElementById('manualTeamConfig');
            manualConfig.style.display = randomize ? 'none' : 'block';

            if (!randomize) {
                renderManualTeamConfig();
            }
        }

        function renderManualTeamConfig() {
            const blueCount = parseInt(document.getElementById('blueCount').value) || 0;
            const redCount = parseInt(document.getElementById('redCount').value) || 0;
            const total = blueCount + redCount;

            const inputs = Array.from(document.querySelectorAll('.player-input'))
                .map(i => i.value.trim())
                .filter(n => n);

            const container = document.getElementById('manualTeamInputs');
            container.innerHTML = '';

            inputs.forEach((player, idx) => {
                const div = document.createElement('div');
                div.className = 'team-row';
                const isBlue = idx < blueCount;
                div.innerHTML = `
                    <label>${player}:</label>
                    <select class="player-team-select" data-player="${player}">
                        <option value="">-- S√©lectionnez --</option>
                        <option value="blue" ${isBlue ? 'selected' : ''}>üîµ Bleu (Sherlock)</option>
                        <option value="red" ${!isBlue && idx < total ? 'selected' : ''}>üî¥ Rouge (Moriarty)</option>
                    </select>
                `;
                container.appendChild(div);
            });
        }

        function startGame() {
            const inputs = Array.from(document.querySelectorAll('.player-input'))
                .map(i => i.value.trim())
                .filter(n => n);

            if (inputs.length < 3) {
                alert('‚ö†Ô∏è Minimum 3 joueurs requis!');
                return;
            }

            const blueCount = parseInt(document.getElementById('blueCount').value) || 0;
            const redCount = parseInt(document.getElementById('redCount').value) || 0;
            const randomize = document.getElementById('randomizeTeams').checked;

            if (blueCount + redCount !== inputs.length) {
                alert(`‚ö†Ô∏è Le nombre de bleus (${blueCount}) + rouges (${redCount}) doit √©galer ${inputs.length} joueurs!`);
                return;
            }

            currentGame = {
                players: inputs,
                teams: { blue: [], red: [] },
                result: null,
                winner: null,
                gameNumber: gameData.games.length + 1
            };

            if (randomize) {
                // Attribution al√©atoire
                const shuffled = [...inputs].sort(() => Math.random() - 0.5);
                currentGame.teams.blue = shuffled.slice(0, blueCount);
                currentGame.teams.red = shuffled.slice(blueCount);
            } else {
                // Attribution manuelle
                const selects = document.querySelectorAll('.player-team-select');
                selects.forEach(select => {
                    const player = select.dataset.player;
                    const team = select.value;
                    if (team === 'blue') {
                        currentGame.teams.blue.push(player);
                    } else if (team === 'red') {
                        currentGame.teams.red.push(player);
                    }
                });
            }

            currentRevealIndex = 0;
            document.getElementById('totalPlayers').textContent = inputs.length;
            switchScreen('revealScreen');
            updateRevealCard();
        }

        // ===== R√âV√âLATION DES R√îLES =====
        let currentRevealIndex = 0;

        function updateRevealCard() {
            const player = currentGame.players[currentRevealIndex];
            const isBlue = currentGame.teams.blue.includes(player);
            const team = isBlue ? 'Sherlock' : 'Moriarty';
            const teamEmoji = isBlue ? 'üîµ' : 'üî¥';

            document.getElementById('cardPlayer').textContent = player;
            document.getElementById('cardRole').textContent = teamEmoji;
            document.getElementById('cardTeam').textContent = team;
            document.getElementById('currentPlayer').textContent = currentRevealIndex + 1;

            const cardBack = document.getElementById('cardBack');
            cardBack.className = 'card-face card-back ' + (isBlue ? 'blue' : 'red');

            const card = document.getElementById('revealCard');
            card.classList.remove('flipped');
        }

        function revealRole() {
            const card = document.getElementById('revealCard');
            card.classList.toggle('flipped');
        }

        function nextRole() {
            if (currentRevealIndex < currentGame.players.length - 1) {
                currentRevealIndex++;
                updateRevealCard();
            }
        }

        function previousRole() {
            if (currentRevealIndex > 0) {
                currentRevealIndex--;
                updateRevealCard();
            }
        }

        function startResult() {
            switchScreen('resultScreen');
        }

        // ===== R√âSULTAT =====
        function setWinner(winner) {
            currentGame.winner = winner;
            renderResultTeams();
            document.getElementById('teamRevealResult').style.display = 'block';
        }

        function renderResultTeams() {
            const container = document.getElementById('resultTeams');
            container.innerHTML = `
                <div class="team-badge blue">
                    <h3>üîµ √âquipe Sherlock</h3>
                    <div class="team-members">${currentGame.teams.blue.join(', ')}</div>
                </div>
                <div class="team-badge red">
                    <h3>üî¥ √âquipe Moriarty</h3>
                    <div class="team-members">${currentGame.teams.red.join(', ')}</div>
                </div>
            `;

            const winnerBanner = document.getElementById('winnerBanner');
            if (currentGame.winner === 'blue') {
                winnerBanner.className = 'winner-banner';
                winnerBanner.innerHTML = 'üéâ Victoire de Sherlock (BLEUS)!';
            } else {
                winnerBanner.className = 'loser-banner';
                winnerBanner.innerHTML = 'üí£ Victoire de Moriarty (ROUGES)!';
            }
        }

        function finishGame() {
            const gameRecord = {
                number: currentGame.gameNumber,
                date: new Date().toLocaleString('fr-FR'),
                players: currentGame.players,
                blueTeam: currentGame.teams.blue,
                redTeam: currentGame.teams.red,
                winner: currentGame.winner
            };

            gameData.games.push(gameRecord);
            
            // Mettre √† jour les stats des joueurs
            currentGame.players.forEach(player => {
                const existing = gameData.players.find(p => p.name === player);
                if (existing) {
                    existing.totalGames++;
                    const isBlue = currentGame.teams.blue.includes(player);
                    if (currentGame.winner === 'blue' && isBlue) {
                        existing.wins++;
                    } else if (currentGame.winner === 'red' && !isBlue) {
                        existing.wins++;
                    }
                } else {
                    const isBlue = currentGame.teams.blue.includes(player);
                    const isWinner = (currentGame.winner === 'blue' && isBlue) || (currentGame.winner === 'red' && !isBlue);
                    gameData.players.push({
                        name: player,
                        totalGames: 1,
                        wins: isWinner ? 1 : 0
                    });
                }
            });

            saveData();
            switchScreen('mainMenu');
        }

        // ===== STATISTIQUES =====
        function renderStats() {
            const container = document.getElementById('statsContent');

            if (gameData.games.length === 0) {
                container.innerHTML = '<div class="no-games">üì≠ Aucune partie jou√©e pour le moment.</div>';
                return;
            }

            // Classement des joueurs
            const sorted = [...gameData.players].sort((a, b) => {
                const winRateA = a.wins / a.totalGames;
                const winRateB = b.wins / b.totalGames;
                return winRateB - winRateA;
            });

            let html = '<div class="stat-card"><h3>üèÜ Classement des Joueurs</h3>';

            sorted.forEach((player, idx) => {
                const winRate = Math.round((player.wins / player.totalGames) * 100);
                const percentage = (player.wins / player.totalGames) * 100;
                html += `
                    <div class="stat-row">
                        <div class="stat-name">${idx + 1}. ${player.name}</div>
                        <div class="stat-value">${player.wins}/${player.totalGames}</div>
                        <div class="stat-bars">
                            <div class="stat-bar">
                                <div class="stat-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                            <span style="min-width: 40px; text-align: right;">${winRate}%</span>
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            // Statistiques g√©n√©rales
            const totalGames = gameData.games.length;
            const blueWins = gameData.games.filter(g => g.winner === 'blue').length;
            const redWins = gameData.games.filter(g => g.winner === 'red').length;

            html += `<div class="stat-card"><h3>üìà Statistiques Globales</h3>
                <div class="stat-row">
                    <div class="stat-name">Parties jou√©es</div>
                    <div class="stat-value">${totalGames}</div>
                </div>
                <div class="stat-row">
                    <div class="stat-name">üîµ Victoires Sherlock</div>
                    <div class="stat-value">${blueWins} (${Math.round(blueWins/totalGames*100)}%)</div>
                </div>
                <div class="stat-row">
                    <div class="stat-name">üî¥ Victoires Moriarty</div>
                    <div class="stat-value">${redWins} (${Math.round(redWins/totalGames*100)}%)</div>
                </div>
            </div>`;

            // Historique des parties
            html += '<div class="stat-card"><h3>üìã Historique des Parties</h3><div class="game-history">';
            gameData.games.slice().reverse().forEach(game => {
                const winnerTeam = game.winner === 'blue' ? 'Sherlock' : 'Moriarty';
                const winnerClass = game.winner === 'blue' ? 'blue-win' : 'red-win';
                const emoji = game.winner === 'blue' ? 'üîµ' : 'üî¥';
                html += `
                    <div class="game-item ${winnerClass}">
                        <div>
                            <span class="game-number">Jeu #${game.number}</span>
                            <span>${game.date}</span>
                        </div>
                        <div class="game-winner">${emoji} ${winnerTeam}</div>
                    </div>
                `;
            });
            html += '</div></div>';

            container.innerHTML = html;
        }

        // ===== INITIALISATION =====
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            initializePlayers();
            document.getElementById('randomizeTeams').addEventListener('change', updateRandomizeState);
        });
    </script>
</body>
</html>