<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeBomb - Assistant de Jeu</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@600&family=Orbitron:wght@400;700;900&family=Audiowide&family=Space+Mono:wght@400;700&family=Playfair+Display:wght@700;900&family=Fredoka:wght@600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary, #0a0a1a) 0%, var(--bg-secondary, #1a2d3a) 50%, var(--bg-primary, #0a0a1a) 100%);
            min-height: 100vh;
            color: #f5f5f0;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        /* Fond avec PAILLETTES LONDONIENNES */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(1px 1px at 5% 10%, #D4AF37, rgba(196,30,58,0)),
                radial-gradient(1px 1px at 15% 25%, #D4AF37, rgba(0,36,125,0)),
                radial-gradient(2px 2px at 25% 5%, #D4AF37, rgba(212,175,55,0)),
                radial-gradient(1px 1px at 35% 45%, #D4AF37, rgba(196,30,58,0)),
                radial-gradient(1px 1px at 45% 15%, #D4AF37, rgba(0,36,125,0)),
                radial-gradient(2px 2px at 55% 60%, #D4AF37, rgba(212,175,55,0)),
                radial-gradient(1px 1px at 65% 30%, #D4AF37, rgba(196,30,58,0)),
                radial-gradient(1px 1px at 75% 70%, #D4AF37, rgba(0,36,125,0)),
                radial-gradient(2px 2px at 85% 40%, #D4AF37, rgba(212,175,55,0)),
                radial-gradient(1px 1px at 95% 80%, #D4AF37, rgba(196,30,58,0)),
                radial-gradient(1px 1px at 10% 55%, #D4AF37, rgba(0,36,125,0)),
                radial-gradient(2px 2px at 20% 75%, #D4AF37, rgba(212,175,55,0)),
                radial-gradient(1px 1px at 30% 65%, #D4AF37, rgba(196,30,58,0)),
                radial-gradient(1px 1px at 40% 85%, #D4AF37, rgba(0,36,125,0)),
                radial-gradient(2px 2px at 50% 35%, #D4AF37, rgba(212,175,55,0)),
                radial-gradient(1px 1px at 60% 95%, #D4AF37, rgba(196,30,58,0)),
                radial-gradient(1px 1px at 70% 20%, #D4AF37, rgba(0,36,125,0)),
                radial-gradient(2px 2px at 80% 50%, #D4AF37, rgba(212,175,55,0)),
                radial-gradient(1px 1px at 90% 10%, #D4AF37, rgba(196,30,58,0)),
                radial-gradient(1px 1px at 12% 90%, #D4AF37, rgba(0,36,125,0));
            background-repeat: repeat;
            background-size: 100% 100%;
            pointer-events: none;
            animation: sparkleRain 15s linear infinite;
            z-index: 0;
        }

        /* Cacher les paillettes or en retrowave et les remplacer */
        body.theme-retrowave::before {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
            z-index: -999 !important;
        }

        /* Cacher les paillettes or pour les autres th√®mes aussi */
        body.theme-goldBomb::before,
        body.theme-business::before,
        body.theme-cyberpunk::before,
        body.theme-random::before {
            opacity: 0 !important;
            pointer-events: none !important;
            z-index: -999 !important;
        }

        @keyframes sparkleRain {
            0% { background-position: 0 0; }
            100% { background-position: 100px 300px; }
        }

        .border-frame {
            max-width: 1000px;
            margin: 0 auto;
            background: linear-gradient(135deg, rgba(42, 90, 90, 0.08) 0%, rgba(42, 90, 90, 0.08) 50%, rgba(42, 90, 90, 0.05) 100%);
            backdrop-filter: blur(15px);
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 
                0 0 120px rgba(212, 175, 55, 0.5),
                0 0 120px rgba(212, 175, 55, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 0 40px rgba(42, 90, 90, 0.15);
            min-height: 100vh;
            position: relative;
            z-index: 2;
            background-clip: padding-box;
            animation: sparkleFrame 4s ease-in-out infinite;
            overflow: hidden;
        }

        /* Pluie de paillettes suppl√©mentaire */
        .border-frame::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(1px 1px at 10% 20%, #D4AF37, transparent),
                radial-gradient(1px 1px at 30% 40%, #D4AF37, transparent),
                radial-gradient(1px 1px at 50% 10%, #D4AF37, transparent),
                radial-gradient(1px 1px at 70% 60%, #D4AF37, transparent),
                radial-gradient(1px 1px at 90% 30%, #D4AF37, transparent),
                radial-gradient(1px 1px at 20% 70%, #D4AF37, transparent),
                radial-gradient(1px 1px at 40% 50%, #D4AF37, transparent),
                radial-gradient(1px 1px at 60% 80%, #D4AF37, transparent),
                radial-gradient(1px 1px at 80% 90%, #D4AF37, transparent);
            background-repeat: repeat;
            background-size: 200px 200px;
            pointer-events: none;
            animation: innerSparkle 8s linear infinite;
            opacity: 0.8;
            border-radius: 20px;
        }

        @keyframes innerSparkle {
            0% { opacity: 0.5; background-position: 0 0; }
            50% { opacity: 0.9; background-position: 100px 100px; }
            100% { opacity: 0.5; background-position: 200px 200px; }
        }

        .container {
            position: relative;
            z-index: 10;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .logo {
            font-family: 'Fredoka', sans-serif;
            font-size: clamp(1.8rem, 6vw, 3.5rem);
            font-weight: 700;
            letter-spacing: 1px;
            color: #D4AF37;
            text-transform: uppercase;
            display: inline-block;
            position: relative;
            animation: logoBounceSparkle 2s ease-in-out infinite;
            text-shadow: 
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(42, 90, 90, 0.5),
                0 0 30px rgba(255, 255, 255, 0.4);
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.6)) drop-shadow(0 0 40px rgba(212, 175, 55, 0.5));
        }

        /* Polices par th√®me */
        body.theme-goldBomb .logo {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            letter-spacing: 2px;
            font-weight: 900;
        }

        body.theme-retrowave .logo {
            font-family: 'Audiowide', cursive;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        body.theme-business .logo {
            font-family: 'Playfair Display', serif;
            letter-spacing: 2px;
            font-weight: 700;
        }

        body.theme-cyberpunk .logo {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        body.theme-random .logo {
            font-family: 'Fredoka', sans-serif;
            font-weight: 900;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .logo::before,
        .logo::after {
            content: '‚ú®';
            position: absolute;
            top: -20px;
            animation: sparkleRotate 2s ease-in-out infinite;
            font-size: 1.5rem;
        }

        .logo::before {
            left: -30px;
            animation-delay: 0s;
            animation: sparkleLeft 2s ease-in-out infinite;
        }

        .logo::after {
            right: -30px;
            animation-delay: 0.3s;
            animation: sparkleRight 2s ease-in-out infinite;
        }

        @keyframes logoBounceSparkle {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        @keyframes sparkleLeft {
            0%, 100% { opacity: 0; transform: translate(-50px, -50px) scale(0); }
            50% { opacity: 1; transform: translate(0, 0) scale(1); }
        }

        @keyframes sparkleRight {
            0%, 100% { opacity: 0; transform: translate(50px, -50px) scale(0); }
            50% { opacity: 1; transform: translate(0, 0) scale(1); }
        }

        .screen { display: none; }
        .screen.active { display: block; }
        
        #deleteConfirmModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        #deleteConfirmModal.modal-visible {
            display: flex !important;
        }

        #themeSelector {
            transition: all 0.3s;
            cursor: pointer;
        }

        #themeSelector:hover {
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.6) !important;
            transform: scale(1.05);
        }

        body.theme-retrowave #themeSelector {
            border-color: #FF10F0 !important;
            color: #FF10F0 !important;
            box-shadow: 0 0 20px rgba(255, 16, 240, 0.3) !important;
        }

        body.theme-business #themeSelector {
            border-color: #C0C0C0 !important;
            color: #1a1410 !important;
            background: rgba(192, 192, 192, 0.9) !important;
        }

        body.theme-cyberpunk #themeSelector {
            border-color: #FF006E !important;
            color: #FF006E !important;
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.3) !important;
        }

        .section-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: #f5f5f0;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
            position: relative;
            display: inline-block;
            animation: titleSparkle 1.5s ease-in-out infinite;
            text-shadow: 
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(212, 175, 55, 0.5);
        }

        .section-title::before,
        .section-title::after {
            content: '‚ú®';
            position: absolute;
            animation: sparkleRotate 2s ease-in-out infinite;
            font-size: 1.2rem;
        }

        .section-title::before {
            left: -40px;
            animation: sparkleRotate 2s ease-in-out infinite 0s;
        }

        .section-title::after {
            right: -40px;
            animation: sparkleRotate 2s ease-in-out infinite 0.5s;
        }

        @keyframes sparkleRotate {
            0%, 100% { opacity: 0; transform: rotate(0deg) scale(0); }
            50% { opacity: 1; transform: rotate(180deg) scale(1); }
        }

        @keyframes titleSparkle {
            0%, 100% { 
                text-shadow: 
                    0 0 10px rgba(255, 255, 255, 0.8),
                    0 0 20px rgba(42, 90, 90, 0.5),
                    0 0 30px rgba(255, 255, 255, 0.4),
                    0 0 40px rgba(212, 175, 55, 0.3);
            }
            50% { 
                text-shadow: 
                    0 0 20px rgba(255, 255, 255, 1),
                    0 0 40px rgba(42, 90, 90, 0.8),
                    0 0 60px rgba(255, 255, 255, 0.6),
                    0 0 80px rgba(212, 175, 55, 0.5);
            }
        }
            50% { text-shadow: 0 0 30px rgba(42, 90, 90, 0.9), 0 0 30px rgba(42, 90, 90, 0.6); }
        .setup-section {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(42, 90, 90, 0.05) 100%);
            border: 2px solid rgba(212, 175, 55, 0.5);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
            position: relative;
            animation: sectionPulseSparkle 2.5s ease-in-out infinite;
            box-shadow: 
                0 0 120px rgba(212, 175, 55, 0.2),
                0 0 120px rgba(212, 175, 55, 0.15),
                inset 0 0 20px rgba(42, 90, 90, 0.08);
        }

        .setup-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(1px 1px at 30% 30%, #D4AF37, transparent),
                radial-gradient(1px 1px at 70% 70%, #D4AF37, transparent),
                radial-gradient(1px 1px at 80% 20%, #D4AF37, transparent),
                radial-gradient(1px 1px at 20% 80%, #D4AF37, transparent);
            background-repeat: repeat;
            background-size: 100% 100%;
            pointer-events: none;
            border-radius: 12px;
            animation: particleFlow 3s linear infinite;
            opacity: 0.6;
        }

        @keyframes sectionPulseSparkle {
            0%, 100% { 
                box-shadow: 0 0 120px rgba(212, 175, 55, 0.2), 0 0 120px rgba(212, 175, 55, 0.15);
            }
            50% { 
                box-shadow: 0 0 60px rgba(42, 90, 90, 0.5), 0 0 120px rgba(212, 175, 55, 0.3), 0 0 140px rgba(212, 175, 55, 0.2);
            }
        }

        @keyframes particleFlow {
            0% { background-position: 0 0; }
            100% { background-position: 100px 100px; }
        }

        .player-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            position: relative;
        }

        .player-input-group::after {
            content: 'üí´';
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            animation: sparkleWiggle 1s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes sparkleWiggle {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.3); }
        }

        .player-input-group input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid rgba(212, 175, 55, 0.3);
            background: rgba(20, 20, 40, 0.6);
            color: #D4AF37; font-weight: 500;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.15), inset 0 0 10px rgba(42, 90, 90, 0.05);
        }

        .player-input-group input:focus {
            outline: none;
            border-color: #D4AF37;
            box-shadow: 
                0 0 30px rgba(42, 90, 90, 0.8),
                0 0 60px rgba(42, 90, 90, 0.5),
                inset 0 0 10px rgba(212, 175, 55, 0.2);
            background: rgba(20, 20, 40, 0.9);
        }

        .btn-remove {
            background: #D4AF37;
            color: #fff;
            border: none;
            padding: 10px 14px;
            cursor: pointer;
            font-weight: 800;
            border-radius: 6px;
            transition: all 0.3s;
            animation: buttonSparkle 1.5s ease-in-out infinite;
        }

        .btn-remove:hover {
            background: #D4AF37;
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(42, 90, 90, 0.8);
        }

        @keyframes buttonSparkle {
            0%, 100% { box-shadow: 0 0 10px rgba(42, 90, 90, 0.5); }
            50% { box-shadow: 0 0 25px rgba(42, 90, 90, 1), 0 0 40px rgba(42, 90, 90, 0.6); }
        }

        button {
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 700;
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
            position: relative;
        }

        .btn-add-player {
            background: rgba(58, 134, 255, 0.9);
            color: #fff;
            border: 2px solid #D4AF37;
            padding: 12px 20px;
            margin-top: 10px;
            box-shadow: 0 0 20px rgba(58, 134, 255, 0.6), 0 0 40px rgba(212, 175, 55, 0.3);
            animation: btnGlow 2s ease-in-out infinite;
        }

        .btn-add-player:hover {
            background: #D4AF37;
            box-shadow: 0 0 50px rgba(58, 134, 255, 1), 0 0 80px rgba(42, 90, 90, 0.7);
            transform: translateY(-3px);
        }

        .btn-start {
            background: linear-gradient(135deg, #D4AF37 0%, #D4AF37 50%, #D4AF37 100%);
            color: #fff;
            border: none;
            width: 100%;
            padding: 16px;
            font-size: 1.1rem;
            margin-top: 20px;
            display: none;
            box-shadow: 0 0 60px rgba(42, 90, 90, 0.7), 0 0 60px rgba(42, 90, 90, 0.5);
            animation: startButtonRainbow 2s ease-in-out infinite;
            background-size: 200% 200%;
        }

        .btn-start.visible { display: block; }

        @keyframes startButtonRainbow {
            0%, 100% { 
                box-shadow: 0 0 60px rgba(42, 90, 90, 0.7), 0 0 60px rgba(42, 90, 90, 0.5);
            }
            50% { 
                box-shadow: 0 0 60px rgba(42, 90, 90, 1), 0 0 150px rgba(42, 90, 90, 0.8), 0 0 200px rgba(42, 90, 90, 0.6);
                transform: scale(1.02);
            }
        }

        .manche-counter {
            font-family: 'Georgia', serif;
            font-size: 5rem;
            font-weight: bold;
            color: #D4AF37;
            margin: 20px 0;
            text-transform: uppercase;
            letter-spacing: -2px;
            animation: counterSparkle 1s ease-in-out infinite;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 1),
                0 0 40px rgba(42, 90, 90, 0.8),
                0 0 60px rgba(255, 255, 255, 0.6),
                0 0 120px rgba(212, 175, 55, 0.5);
            position: relative;
            display: inline-block;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8)) drop-shadow(0 0 20px rgba(42, 90, 90, 0.5));
        }

        .manche-counter::before,
        .manche-counter::after {
            content: '‚ú®';
            position: absolute;
            animation: sparkleOrbit 2s linear infinite;
            font-size: 2rem;
        }

        .manche-counter::before {
            left: -120px;
            top: 50%;
            animation: sparkleOrbit 2s linear infinite;
        }

        .manche-counter::after {
            right: -120px;
            top: 50%;
            animation: sparkleOrbit 2s linear infinite 1s;
        }

        @keyframes counterSparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        @keyframes sparkleOrbit {
            0% { opacity: 0; transform: translate(0, -30px) scale(0); }
            25% { opacity: 1; }
            75% { opacity: 1; }
            100% { opacity: 0; transform: translate(0, 30px) scale(0); }
        }

        @keyframes podiumBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.05); }
        }

        @keyframes platformGlow {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(42, 90, 90, 0.8), 0 0 120px rgba(212, 175, 55, 0.5), inset 0 0 20px rgba(255, 255, 255, 0.3);
            }
            50% { 
                box-shadow: 0 0 60px rgba(42, 90, 90, 1), 0 0 60px rgba(42, 90, 90, 0.6), inset 0 0 30px rgba(255, 255, 255, 0.5);
            }
        }

        .turn-button {
            background: linear-gradient(135deg, rgba(42, 90, 90, 0.95) 0%, rgba(42, 90, 90, 0.9) 100%);
            color: #fff;
            border: none;
            width: 100%;
            padding: 40px 20px;
            font-size: 1.3rem;
            margin: 40px 0;
            text-transform: uppercase;
            font-weight: 800;
            letter-spacing: 2px;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 0 30px rgba(42, 90, 90, 0.7), 0 0 60px rgba(42, 90, 90, 0.5);
            animation: turnButtonPulse 2s ease-in-out infinite;
        }

        .turn-button::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #D4AF37, transparent);
            border-radius: 12px;
            animation: sparkleStream 1s linear infinite;
        }

        @keyframes turnButtonPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(42, 90, 90, 0.7), 0 0 60px rgba(42, 90, 90, 0.5); }
            50% { box-shadow: 0 0 80px rgba(42, 90, 90, 1), 0 0 150px rgba(42, 90, 90, 0.8), 0 0 200px rgba(42, 90, 90, 0.6); }
        }

        @keyframes sparkleStream {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .stats-section {
            background: linear-gradient(135deg, rgba(42, 90, 90, 0.12) 0%, rgba(42, 90, 90, 0.08) 100%);
            border: 2px solid rgba(42, 90, 90, 0.5);
            padding: 30px;
            margin-bottom: 20px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
            position: relative;
            animation: sectionPulseSparkle 2.5s ease-in-out infinite;
            box-shadow: 
                0 0 120px rgba(212, 175, 55, 0.5),
                0 0 120px rgba(212, 175, 55, 0.3),
                inset 0 0 40px rgba(212, 175, 55, 0.15);
        }

        .stats-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(1px 1px at 20% 40%, #D4AF37, transparent),
                radial-gradient(1px 1px at 80% 60%, #D4AF37, transparent),
                radial-gradient(1px 1px at 50% 80%, #D4AF37, transparent);
            background-repeat: repeat;
            background-size: 80px 80px;
            pointer-events: none;
            border-radius: 12px;
            animation: particleFlow 4s linear infinite;
            opacity: 0.7;
        }

        .player-input-group {
            position: relative;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-action {
            background: rgba(58, 134, 255, 0.85);
            color: #fff;
            border: 2px solid #D4AF37;
            padding: 12px 20px;
            flex: 1;
            min-width: 150px;
            border-radius: 8px;
            font-weight: 700;
            box-shadow: 0 0 30px rgba(58, 134, 255, 0.6);
            animation: btnGlow 2s ease-in-out infinite;
        }

        @keyframes btnGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(58, 134, 255, 0.5), 0 0 40px rgba(212, 175, 55, 0.2); }
            25% { box-shadow: 0 0 40px rgba(58, 134, 255, 0.8), 0 0 80px rgba(42, 90, 90, 0.5), 0 0 120px rgba(212, 175, 55, 0.2); }
            50% { box-shadow: 0 0 60px rgba(58, 134, 255, 1), 0 0 120px rgba(42, 90, 90, 0.7), 0 0 180px rgba(212, 175, 55, 0.5); }
            75% { box-shadow: 0 0 40px rgba(58, 134, 255, 0.8), 0 0 80px rgba(42, 90, 90, 0.5), 0 0 120px rgba(212, 175, 55, 0.2); }
        }

        @keyframes sparkleFlash {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        /* √âl√©ments qui clignotent partout */
        .player-input-group::before {
            content: '‚ú®';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            animation: sparkleFlash 0.8s ease-in-out infinite;
            pointer-events: none;
            font-size: 0.8rem;
        }

        .player-input-group::after {
            animation: sparkleWiggle 1s ease-in-out infinite, sparkleFlash 0.6s ease-in-out infinite;
        }

        .btn-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 50px rgba(58, 134, 255, 1), 0 0 60px rgba(42, 90, 90, 0.8);
        }

        /* Styles restants */
        .end-manche-section {
            background: rgba(42, 90, 90, 0.08);
            border: 2px solid rgba(212, 175, 55, 0.3);
            padding: 25px;
            margin: 20px 0;
            border-radius: 12px;
            backdrop-filter: blur(5px);
        }

        .team-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(20, 20, 40, 0.6);
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .team-selector label {
            flex: 0 0 120px;
            font-weight: 700;
        }

        .team-toggle {
            display: flex;
            background: rgba(20, 20, 40, 0.4);
            flex: 1;
            border-radius: 6px;
        }

        .team-btn {
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            flex: 1;
            color: #D4AF37;
            background: transparent;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            transition: all 0.3s;
        }

        .team-btn.active {
            font-weight: 800;
            color: #fff;
        }

        .team-btn.blue.active { background: rgba(58, 134, 255, 0.8); }
        .team-btn.red.active { background: rgba(42, 90, 90, 0.8); }

        .winner-section {
            background: rgba(42, 90, 90, 0.08);
            border: 2px solid rgba(212, 175, 55, 0.3);
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            border-radius: 12px;
        }

        .winner-buttons {
            display: flex;
            gap: 15px;
        }

        .btn-winner {
            padding: 14px 20px;
            border: 2px solid;
            font-weight: 700;
            flex: 1;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-winner.blue {
            background: rgba(58, 134, 255, 0.8);
            border-color: #D4AF37;
            color: #fff;
        }

        .btn-winner.red {
            background: rgba(220, 20, 60, 0.8);
            border-color: #D4AF37;
            color: #fff;
        }

        .btn-winner:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.6);
        }

        /* Tables et autres */
        .setup-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(20, 20, 40, 0.4);
            border-radius: 8px;
            overflow: hidden;
        }

        .setup-table th, .setup-table td {
            padding: 14px;
            text-align: center;
            border-bottom: 1px solid rgba(212, 175, 55, 0.15);
        }

        .setup-table th {
            background: rgba(42, 90, 90, 0.15);
            color: #D4AF37;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .setup-table tr.highlight {
            background: rgba(212, 175, 55, 0.2);
            border-left: 4px solid #D4AF37;
        }

        .histogram-container {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
            min-height: 350px;
            padding: 30px;
            background: rgba(20, 20, 40, 0.4);
            border-radius: 12px;
            overflow-x: auto;
        }

        .histogram-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .bar-vertical {
            width: 80px;
            height: 300px;
            display: flex;
            flex-direction: column-reverse;
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            background: rgba(20, 20, 40, 0.5);
            overflow: hidden;
        }

        .bar-segment {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 800;
            color: #fff;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
            min-height: 25px;
            border-top: 1px solid rgba(0, 0, 0, 0.3);
        }

        .segment-blue-win { background: linear-gradient(180deg, rgba(58, 134, 255, 0.95) 0%, rgba(58, 134, 255, 0.85) 100%); color: #fff; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .segment-blue-lost { background: linear-gradient(180deg, rgba(58, 134, 255, 0.5) 0%, rgba(58, 134, 255, 0.35) 100%); color: rgba(255, 255, 255, 0.8); font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .segment-red-win { background: linear-gradient(180deg, rgba(220, 20, 60, 0.95) 0%, rgba(220, 20, 60, 0.85) 100%); color: #fff; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .segment-red-lost { background: linear-gradient(180deg, rgba(220, 20, 60, 0.5) 0%, rgba(220, 20, 60, 0.35) 100%); color: rgba(255, 255, 255, 0.8); font-weight: bold; display: flex; align-items: center; justify-content: center; }

        .player-name-bar {
            text-align: center;
            color: #D4AF37; font-weight: 500;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .player-score {
            font-size: 0.85rem;
            color: #D4AF37;
            margin-top: 4px;
        }

        .progression-player {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(20, 20, 40, 0.4);
            border-left: 4px solid #D4AF37;
            border-radius: 8px;
        }

        .progression-name {
            font-weight: 800;
            color: #D4AF37; font-weight: 500;
            margin-bottom: 8px;
        }

        .progression-line {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .progression-manche {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .manche-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid;
            font-size: 1.2rem;
            position: relative;
            animation: iconSparkle 1.5s ease-in-out infinite;
        }

        @keyframes iconSparkle {
            0%, 100% { box-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }
            50% { box-shadow: 0 0 25px rgba(42, 90, 90, 0.9), 0 0 40px rgba(42, 90, 90, 0.6); }
        }

        .manche-icon.blue-win {
            background: linear-gradient(135deg, rgba(58, 134, 255, 0.9) 0%, rgba(58, 134, 255, 0.7) 100%);
            border-color: rgba(58, 134, 255, 0.9);
            animation: emojiBounce 0.6s ease-in-out infinite, iconSparkle 1.5s ease-in-out infinite;
        }

        .manche-icon.blue-lost {
            background: linear-gradient(135deg, rgba(58, 134, 255, 0.5) 0%, rgba(58, 134, 255, 0.3) 100%);
            border-color: rgba(58, 134, 255, 0.6);
            animation: emojiShake 0.5s ease-in-out infinite;
        }

        .manche-icon.red-win {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.9) 0%, rgba(220, 20, 60, 0.7) 100%);
            border-color: rgba(220, 20, 60, 0.9);
            animation: emojiBounce 0.6s ease-in-out infinite, iconSparkle 1.5s ease-in-out infinite;
        }

        .manche-icon.red-lost {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.5) 0%, rgba(220, 20, 60, 0.3) 100%);
            border-color: rgba(220, 20, 60, 0.6);
            animation: emojiShake 0.5s ease-in-out infinite;
        }

        @keyframes emojiBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        @keyframes emojiShake {
            0%, 100% { transform: translateX(0px) scale(1); }
            25% { transform: translateX(-3px) scale(1); }
            75% { transform: translateX(3px) scale(1); }
            50% { transform: translateX(0px) scale(1.1); }
        }

        .manche-number {
            font-size: 0.7rem;
            color: #D4AF37;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(20, 20, 40, 0.4);
            border-radius: 8px;
            overflow: hidden;
        }

        .summary-table th {
            background: rgba(42, 90, 90, 0.15);
            color: #D4AF37;
            padding: 12px;
            text-align: left;
            border: none;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .summary-table td {
            padding: 12px;
            border: none;
            border-bottom: 1px solid rgba(212, 175, 55, 0.15);
            color: #D4AF37;
        }

        .summary-table tr:hover {
            background: rgba(212, 175, 55, 0.15);
        }

        .btn-end {
            background: transparent;
            border-color: rgba(42, 90, 90, 0.5);
            color: #D4AF37;
        }

        .btn-end:hover {
            background: rgba(212, 175, 55, 0.15);
        }

        /* ===== TH√àMES DE COULEURS ===== */
        
        /* TH√àME 1: GOLD BOMB (Big Ben Dramatique) */
        body.theme-goldBomb {
            --primary-color: #D4AF37;
            --secondary-color: #FFD700;
            --accent-color: #FF4444;
            --bg-primary: #0a0a1a;
            --bg-secondary: #1a2d3a;
            --team-blue: rgba(58, 134, 255, 0.9);
            --team-blue-dark: rgba(58, 134, 255, 0.5);
            --team-red: rgba(220, 20, 60, 0.9);
            --team-red-dark: rgba(220, 20, 60, 0.5);
            animation: goldenPulse 4s infinite;
        }

        @keyframes goldenPulse {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 0 transparent); }
            50% { filter: brightness(1.1) drop-shadow(0 0 30px rgba(212, 175, 55, 0.8)); }
        }

        /* TH√àME 2: RETROWAVE (Bleu/Rose Glam) */
        body.theme-retrowave {
            --primary-color: #FF10F0;
            --secondary-color: #00F0FF;
            --accent-color: #B200FF;
            --bg-primary: #050415;
            --bg-secondary: #0a0a2a;
            --team-blue: rgba(0, 240, 255, 0.9);
            --team-blue-dark: rgba(0, 240, 255, 0.5);
            --team-red: rgba(255, 16, 240, 0.9);
            --team-red-dark: rgba(255, 16, 240, 0.5);
        }

        /* TH√àME 3: BUSINESS (Marron/Argent) */
        body.theme-business {
            --primary-color: #C0C0C0;
            --secondary-color: #E8E8E8;
            --accent-color: #8B6F47;
            --bg-primary: #1a1410;
            --bg-secondary: #2d2520;
            --team-blue: rgba(70, 130, 180, 0.9);
            --team-blue-dark: rgba(70, 130, 180, 0.5);
            --team-red: rgba(139, 69, 19, 0.9);
            --team-red-dark: rgba(139, 69, 19, 0.5);
            animation: subtleGlow 6s infinite ease-in-out;
        }

        @keyframes subtleGlow {
            0%, 100% { filter: brightness(1) saturate(1); }
            50% { filter: brightness(1.05) saturate(1.1); }
        }

        /* TH√àME 4: CYBERPUNK (N√©on Futuriste) */
        body.theme-cyberpunk {
            --primary-color: #FF006E;
            --secondary-color: #00D9FF;
            --accent-color: #B300FF;
            --bg-primary: #050008;
            --bg-secondary: #0a0015;
            --team-blue: rgba(0, 217, 255, 0.9);
            --team-blue-dark: rgba(0, 217, 255, 0.5);
            --team-red: rgba(255, 0, 110, 0.9);
            --team-red-dark: rgba(255, 0, 110, 0.5);
        }

        /* TH√àME 5: AL√âATOIRE (Couleurs g√©n√©r√©es au hasard) */
        body.theme-random {
            --primary-color: var(--random-color1, #FF10F0);
            --secondary-color: var(--random-color2, #00F0FF);
            --accent-color: var(--random-color3, #FFFF00);
            --bg-primary: #050505;
            --bg-secondary: #0a0a0a;
            --team-blue: rgba(0, 200, 255, 0.9);
            --team-blue-dark: rgba(0, 200, 255, 0.5);
            --team-red: rgba(255, 50, 150, 0.9);
            --team-red-dark: rgba(255, 50, 150, 0.5);
            animation: chromaShift 5s infinite;
        }

        @keyframes chromaShift {
            0%, 100% { filter: hue-rotate(0deg) contrast(1); }
            25% { filter: hue-rotate(30deg) contrast(1.1); }
            50% { filter: hue-rotate(-30deg) contrast(0.95); }
            75% { filter: hue-rotate(15deg) contrast(1.05); }
        }

        /* Appliquer les variables √† tous les th√®mes */

        body .section-title,
        body .logo,
        body .manche-counter {
            color: var(--primary-color, #D4AF37);
        }

        body .btn-action, body .btn-add-player, body .turn-button {
            background: linear-gradient(135deg, var(--primary-color, #D4AF37) 0%, var(--secondary-color, #FFD700) 100%);
        }

        /* ===== STYLES SP√âCIFIQUES PAR TH√àME ===== */
        
        /* RETROWAVE - Paillettes partout */
        body.theme-retrowave {
            background: 
                linear-gradient(135deg, #050415 0%, #0a0a2a 50%, #050415 100%),
                radial-gradient(1px 1px at 5% 10%, #FF10F0, rgba(255,16,240,0)),
                radial-gradient(1px 1px at 15% 25%, #00F0FF, rgba(0,240,255,0)),
                radial-gradient(2px 2px at 25% 5%, #B200FF, rgba(178,0,255,0)),
                radial-gradient(1px 1px at 35% 45%, #FF10F0, rgba(255,16,240,0)),
                radial-gradient(1px 1px at 45% 15%, #00F0FF, rgba(0,240,255,0)),
                radial-gradient(2px 2px at 55% 60%, #B200FF, rgba(178,0,255,0)),
                radial-gradient(1px 1px at 65% 30%, #FF10F0, rgba(255,16,240,0)),
                radial-gradient(1px 1px at 75% 70%, #00F0FF, rgba(0,240,255,0)),
                radial-gradient(2px 2px at 85% 40%, #B200FF, rgba(178,0,255,0)),
                radial-gradient(1px 1px at 95% 80%, #FF10F0, rgba(255,16,240,0)) !important;
            animation: sparkleRain 10s linear infinite;
        }

        /* CYBERPUNK - Effet n√©on stroboscopique */
        body.theme-cyberpunk {
            background: linear-gradient(135deg, #050008 0%, #0a0015 50%, #050008 100%) !important;
            animation: neonFlicker 3s infinite;
        }

        @keyframes neonFlicker {
            0%, 100% { filter: brightness(1) hue-rotate(0deg); }
            20% { filter: brightness(1.1) hue-rotate(10deg); }
            40% { filter: brightness(0.95) hue-rotate(-5deg); }
            60% { filter: brightness(1.05) hue-rotate(5deg); }
            80% { filter: brightness(1.15) hue-rotate(15deg); }
        }

        /* Glow des titres par th√®me */
        body.theme-goldBomb .section-title { text-shadow: 0 0 20px rgba(212, 175, 55, 0.8), 0 0 40px rgba(255, 68, 68, 0.4); }
        body.theme-retrowave .section-title { text-shadow: 0 0 25px rgba(255, 16, 240, 0.9), 0 0 50px rgba(0, 240, 255, 0.6), 0 0 75px rgba(255, 255, 0, 0.3); }
        body.theme-business .section-title { text-shadow: 0 0 20px rgba(192, 192, 192, 0.8); }
        body.theme-cyberpunk .section-title { text-shadow: 0 0 25px rgba(255, 0, 110, 0.9), 0 0 50px rgba(0, 217, 255, 0.6), 0 0 75px rgba(179, 0, 255, 0.3); }

        /* Bordures par th√®me avec glow */
        body.theme-goldBomb .border-frame { 
            border-color: rgba(212, 175, 55, 0.3) !important;
            box-shadow: 0 0 120px rgba(212, 175, 55, 0.5), 0 0 120px rgba(212, 175, 55, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 0 40px rgba(212, 175, 55, 0.15) !important;
        }
        
        body.theme-retrowave .border-frame { 
            border-color: rgba(255, 16, 240, 0.5) !important;
            box-shadow: none !important;
        }
        
        body.theme-business .border-frame { 
            border-color: rgba(192, 192, 192, 0.3) !important;
            box-shadow: 0 0 120px rgba(192, 192, 192, 0.4), 0 0 120px rgba(192, 192, 192, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 0 40px rgba(192, 192, 192, 0.1) !important;
        }
        
        body.theme-cyberpunk .border-frame { 
            border-color: rgba(255, 0, 110, 0.3) !important;
            box-shadow: 0 0 120px rgba(255, 0, 110, 0.5), 0 0 120px rgba(0, 217, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 0 40px rgba(255, 0, 110, 0.15) !important;
        }
        
        body.theme-random .border-frame { 
            border-color: rgba(255, 255, 255, 0.3) !important;
            box-shadow: 0 0 120px var(--random-color1), 0 0 120px var(--random-color2), inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 0 40px var(--random-color1) !important;
        }

        /* Boutons par th√®me */

        body.theme-business .btn-action, 
        body.theme-business .btn-add-player, 
        body.theme-business .turn-button { 
            background: linear-gradient(135deg, #C0C0C0 0%, #E8E8E8 100%);
            color: #1a1410;
        }

        body.theme-cyberpunk .btn-action, 
        body.theme-cyberpunk .btn-add-player, 
        body.theme-cyberpunk .turn-button { 
            background: linear-gradient(135deg, #FF006E 0%, #00D9FF 100%);
        }

        /* AL√âATOIRE - Couleurs g√©n√©r√©es */
body.theme-random .section-title { 
            text-shadow: 0 0 20px var(--random-color1), 0 0 40px var(--random-color2); 
        }

        body.theme-random .btn-action, 
        body.theme-random .btn-add-player, 
        body.theme-random .turn-button { 
            background: linear-gradient(135deg, var(--random-color1) 0%, var(--random-color2) 100%);
        }

        /* MODE PAILLETTES (d√©faut) */
        body.sparkle-mode::before {
            animation: sparkleRain 15s linear infinite;
            opacity: 1;
        }

        body.sparkle-mode .section-title,
        body.sparkle-mode .logo,
        body.sparkle-mode .manche-counter {
            animation: titleSparkle 1.5s ease-in-out infinite;
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        body.sparkle-mode .section-title::before,
        body.sparkle-mode .section-title::after {
            opacity: 1;
            animation: sparkleRotate 2s ease-in-out infinite;
        }

        body.sparkle-mode .btn-action,
        body.sparkle-mode .btn-add-player,
        body.sparkle-mode .turn-button,
        body.sparkle-mode .btn-start {
            animation: btnGlow 2s ease-in-out infinite;
        }

        /* MODE SOBRE (√©pur√©) */
        body.sober-mode::before {
            animation: none !important;
            opacity: 0 !important;
        }

        body.sober-mode .section-title,
        body.sober-mode .logo,
        body.sober-mode .manche-counter {
            animation: none !important;
            text-shadow: none !important;
        }

        body.sober-mode .section-title::before,
        body.sober-mode .section-title::after {
            opacity: 0 !important;
        }

        body.sober-mode .section-title::before,
        body.sober-mode .section-title::after,
        body.sober-mode .logo::before,
        body.sober-mode .logo::after {
            display: none !important;
        }

        body.sober-mode .btn-action,
        body.sober-mode .btn-add-player,
        body.sober-mode .turn-button,
        body.sober-mode .btn-start {
            animation: none !important;
        }

        body.sober-mode .manche-counter::before,
        body.sober-mode .manche-counter::after {
            display: none !important;
        }

        /* Paillettes et animations r√©duites en mode sobre */
        body.sober-mode .border-frame::after {
            animation: none !important;
            opacity: 0 !important;
        }

        /* ===== TH√àME √âPIQUE BIG BEN + BOMBES ===== */
        
        @keyframes dangerPulse {
            0%, 100% { 
                text-shadow: 0 0 20px rgba(212, 175, 55, 0.8), 0 0 40px rgba(212, 175, 55, 0.4);
            }
            50% { 
                text-shadow: 0 0 20px rgba(255, 68, 68, 1), 0 0 40px rgba(255, 68, 68, 0.6), 0 0 80px rgba(212, 175, 55, 0.3);
            }
        }

        @keyframes goldGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.6)) drop-shadow(0 0 20px rgba(212, 175, 55, 0.3)); }
            50% { filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.9)) drop-shadow(0 0 40px rgba(212, 175, 55, 0.6)) drop-shadow(0 0 60px rgba(255, 68, 68, 0.3)); }
        }

        @keyframes emergencyAlert {
            0%, 90%, 100% { opacity: 1; }
            95% { opacity: 0.7; }
        }

        body.sparkle-mode .manche-counter {
            animation: dangerPulse 1.5s ease-in-out infinite !important;
            color: #D4AF37 !important;
            text-shadow: 0 0 30px rgba(212, 175, 55, 0.8), 0 0 60px rgba(212, 175, 55, 0.4) !important;
        }

        body.sparkle-mode .logo {
            animation: goldGlow 2s ease-in-out infinite !important;
            color: #D4AF37 !important;
        }

        body.sparkle-mode .section-title {
            color: #D4AF37 !important;
            animation: dangerPulse 2s ease-in-out infinite !important;
        }


        .setup-section {
            border-left-color: #D4AF37 !important;
        }

        .btn-action, .btn-add-player, .turn-button {
            color: #fff !important;
            font-weight: 900 !important;
        }

        .btn-start {
            font-weight: 900 !important;
        }

        /* Boutons par th√®me */
        body.theme-goldBomb .btn-action,
        body.theme-goldBomb .btn-add-player,
        body.theme-goldBomb .turn-button {
            background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%) !important;
            color: #0a0a1a !important;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.6) !important;
        }

        body.theme-goldBomb .btn-start {
            background: linear-gradient(135deg, #FFD700 0%, #D4AF37 100%) !important;
            color: #0a0a1a !important;
            box-shadow: 0 0 80px rgba(212, 175, 55, 0.8), 0 0 160px rgba(212, 175, 55, 0.5) !important;
        }

        body.theme-retrowave .btn-action,
        body.theme-retrowave .btn-add-player,
        body.theme-retrowave .turn-button {
            background: linear-gradient(135deg, #FF10F0 0%, #00F0FF 100%) !important;
            box-shadow: 0 0 40px rgba(255, 16, 240, 0.6), 0 0 80px rgba(0, 240, 255, 0.3) !important;
        }

        body.theme-retrowave .btn-start {
            background: linear-gradient(135deg, #00F0FF 0%, #FF10F0 100%) !important;
            box-shadow: 0 0 80px rgba(255, 16, 240, 0.8), 0 0 160px rgba(0, 240, 255, 0.5) !important;
        }

        body.theme-business .btn-action,
        body.theme-business .btn-add-player,
        body.theme-business .turn-button {
            background: linear-gradient(135deg, #C0C0C0 0%, #E8E8E8 100%) !important;
            color: #1a1410 !important;
            box-shadow: 0 0 20px rgba(192, 192, 192, 0.4) !important;
        }

        body.theme-business .btn-start {
            background: linear-gradient(135deg, #E8E8E8 0%, #C0C0C0 100%) !important;
            color: #1a1410 !important;
            box-shadow: 0 0 40px rgba(192, 192, 192, 0.6) !important;
        }

        body.theme-cyberpunk .btn-action,
        body.theme-cyberpunk .btn-add-player,
        body.theme-cyberpunk .turn-button {
            background: linear-gradient(135deg, #FF006E 0%, #00D9FF 100%) !important;
            box-shadow: 0 0 40px rgba(255, 0, 110, 0.6), 0 0 80px rgba(0, 217, 255, 0.3) !important;
        }

        body.theme-cyberpunk .btn-start {
            background: linear-gradient(135deg, #00D9FF 0%, #FF006E 100%) !important;
            box-shadow: 0 0 80px rgba(255, 0, 110, 0.8), 0 0 160px rgba(0, 217, 255, 0.5) !important;
        }

        body.theme-random .btn-action,
        body.theme-random .btn-add-player,
        body.theme-random .turn-button {
            background: linear-gradient(135deg, var(--random-color1) 0%, var(--random-color2) 100%) !important;
            box-shadow: 0 0 40px var(--random-color1), 0 0 80px var(--random-color2) !important;
        }

        body.theme-random .btn-start {
            background: linear-gradient(135deg, var(--random-color2) 0%, var(--random-color1) 100%) !important;
            box-shadow: 0 0 80px var(--random-color1), 0 0 160px var(--random-color2) !important;
        }
        /* SAVED GAME STYLES */
        .saved-game-disabled {
            opacity: 0.4;
            pointer-events: none;
        }
        .saved-game-disabled button {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .saved-game-enabled {
            opacity: 1;
            pointer-events: auto;
        }
        .saved-game-enabled button {
            cursor: pointer;
            opacity: 1;
        }

        /* RESPECTER LES PR√âF√âRENCES DE R√âDUCTION DE MOUVEMENT */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
            
            body::before {
                animation: none !important;
            }
            
            .border-frame {
                animation: none !important;
                backdrop-filter: none !important;
            }
        }

        /* ===== RESPONSIVE DESIGN MOBILE ===== */
        @media (max-width: 768px) {
            /* D√âSACTIVER ANIMATIONS SUR MOBILE POUR PERFORMANCE */
            * {
                animation: none !important;
            }

            body::before {
                animation: none !important;
            }

            .border-frame {
                animation: none !important;
                box-shadow: 0 0 20px rgba(212, 175, 55, 0.3) !important;
                backdrop-filter: none !important;
            }

            .logo {
                animation: none !important;
                filter: none !important;
            }

            .section-title {
                animation: none !important;
                filter: none !important;
            }

            /* R√©duire blur */
            .border-frame {
                backdrop-filter: blur(5px) !important;
            }

            header {
                margin-bottom: 20px;
            }

            .border-frame {
                padding: 15px 20px;
                border-radius: 12px;
            }

            .container {
                padding: 0;
            }

            .section-title {
                font-size: 1.2rem;
            }

            #themeSelector {
                padding: 8px 12px !important;
                font-size: 0.75rem !important;
                right: 10px !important;
                top: 10px !important;
            }

            .setup-section,
            .player-list,
            .stats-section {
                padding: 15px;
            }

            .btn-action,
            .btn-add-player,
            .turn-button,
            .btn-start {
                padding: 10px 15px !important;
                font-size: 0.9rem !important;
            }

            .manche-counter {
                font-size: 2rem !important;
            }
        }

        @media (max-width: 480px) {
            /* D√âSACTIVER ANIMATIONS SUR TR√àS PETIT √âCRAN */
            * {
                animation: none !important;
            }

            body::before {
                animation: none !important;
            }

            .border-frame {
                animation: none !important;
                box-shadow: 0 0 10px rgba(212, 175, 55, 0.2) !important;
                backdrop-filter: none !important;
            }

            .logo {
                filter: none !important;
            }

            .section-title {
                filter: none !important;
            }

            body {
                padding: 10px !important;
            }

            header {
                margin-bottom: 15px;
            }

            .border-frame {
                padding: 10px 15px;
            }

            .logo {
                font-size: clamp(1.5rem, 5vw, 2.5rem) !important;
                margin-bottom: 10px;
            }

            .section-title {
                font-size: 1rem;
                margin-bottom: 10px;
            }

            .btn-action,
            .btn-add-player,
            .turn-button,
            .btn-start {
                padding: 8px 12px !important;
                font-size: 0.8rem !important;
            }

            input[type="text"] {
                padding: 8px !important;
                font-size: 0.9rem !important;
            }
        }
    </style>
</head>
<body id="bodyContent">

    <!-- S√âLECTEUR DE TH√àME -->
    <div style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
        <select id="themeSelector" style="padding: 12px 18px; border: 2px solid #D4AF37; background: rgba(10, 10, 26, 0.95); color: #D4AF37; cursor: pointer; border-radius: 8px; font-weight: 800; letter-spacing: 1px; font-size: 0.9rem; box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);" onchange="changeTheme(this.value)">
            <option value="goldBomb">üîîüí£ Gold Bomb (Big Ben)</option>
            <option value="retrowave">üåä Retrowave (Glam 80s)</option>
            <option value="business">üíº Business (Marron/Argent)</option>
            <option value="cyberpunk">ü§ñ Cyberpunk (Futuriste)</option>
            <option value="random">üé≤ Al√©atoire</option>
            <option value="">---</option>
            <option value="clearCache">üóëÔ∏è Vider Cache</option>
        </select>
    </div>
    
    <div class="border-frame">
        <div class="container">
            <header>
                <div class="logo">‚è∞ TimeBomb Assistant üí£</div>
            </header>

            <!-- SETUP -->
            <div id="setupScreen" class="screen active">
                <div id="savedGameAlert" style="background: linear-gradient(135deg, rgba(42, 90, 90, 0.15) 0%, rgba(212, 175, 55, 0.15) 100%); border: 2px solid #D4AF37; padding: 25px; margin-bottom: 25px; border-radius: 12px; box-shadow: 0 0 120px rgba(212, 175, 55, 0.3), 0 0 120px rgba(212, 175, 55, 0.2); backdrop-filter: blur(10px); position: relative; transition: all 0.3s;" class="saved-game-disabled">
                    <div style="color: #D4AF37; font-weight: 500; font-weight: 900; margin-bottom: 20px; font-size: 1.5rem; letter-spacing: 2px; text-transform: uppercase; font-family: 'Inter', sans-serif; text-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 0 0 30px rgba(42, 90, 90, 0.5); animation: titleSparkle 1.5s ease-in-out infinite;">
                        ‚ö° REPRENDRE LA PARTIE ‚ö°
                    </div>
                    
                    <div style="background: rgba(20, 20, 40, 0.4); padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #D4AF37; position: relative;">
                        <div id="savedGameDetails" style="color: #D4AF37; font-weight: 500; font-size: 0.95rem; line-height: 2.2; font-weight: 500;">Aucune partie sauvegard√©e. Cr√©e une nouvelle partie pour commencer!</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                        <button onclick="continueSavedGame()" style="background: linear-gradient(135deg, #D4AF37 0%, #D4AF37 100%); color: #fff; border: none; padding: 12px 20px; cursor: pointer; border-radius: 8px; font-weight: 800; letter-spacing: 1px; transition: all 0.3s; box-shadow: 0 0 40px rgba(42, 90, 90, 0.6), 0 0 80px rgba(212, 175, 55, 0.5); text-transform: uppercase; font-size: 0.85rem; animation: btnGlow 2s ease-in-out infinite;" onmouseover="this.style.boxShadow='0 0 60px rgba(42, 90, 90, 0.9), 0 0 120px rgba(42, 90, 90, 0.7)'; this.style.transform='translateY(-3px)';" onmouseout="this.style.boxShadow='0 0 40px rgba(42, 90, 90, 0.6), 0 0 80px rgba(212, 175, 55, 0.5)'; this.style.transform='translateY(0)';">‚Üª CONTINUER</button>
                        <button onclick="goToStats()" style="background: linear-gradient(135deg, #D4AF37 0%, #D4AF37 100%); color: #fff; border: none; padding: 12px 20px; cursor: pointer; border-radius: 8px; font-weight: 800; letter-spacing: 1px; transition: all 0.3s; box-shadow: 0 0 40px rgba(42, 90, 90, 0.6); text-transform: uppercase; font-size: 0.85rem;" onmouseover="this.style.boxShadow='0 0 60px rgba(42, 90, 90, 0.9)'; this.style.transform='translateY(-3px)';" onmouseout="this.style.boxShadow='0 0 40px rgba(42, 90, 90, 0.6)'; this.style.transform='translateY(0)';">üìä STATS</button>
                        <button onclick="clearSavedGame()" style="background: transparent; color: #D4AF37; border: 2px solid #D4AF37; padding: 10px 15px; cursor: pointer; border-radius: 8px; font-weight: 800; letter-spacing: 1px; transition: all 0.3s; text-transform: uppercase; font-size: 0.85rem;" onmouseover="this.style.background='rgba(212, 175, 55, 0.2)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 0 30px rgba(42, 90, 90, 0.6)';" onmouseout="this.style.background='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">üóëÔ∏è SUPPRIMER</button>
                    </div>
                </div>

                <div class="setup-section">
                    <div class="section-title">üë• Ajoute les Joueurs</div>
                    <div id="playersInput"></div>
                    <button class="btn-add-player" onclick="addPlayer()">+ Ajouter un Joueur</button>
                </div>

                <div class="setup-section">
                    <div class="section-title">üìã Tableau de Mise en Place</div>
                    <table class="setup-table">
                        <thead><tr><th>Joueurs</th><th>üé¥</th><th>‚ö°</th><th>üí£</th></tr></thead>
                        <tbody id="setupTableBody">
                            <tr><td>4</td><td>15</td><td>4</td><td>1</td></tr>
                            <tr><td>5</td><td>19</td><td>5</td><td>1</td></tr>
                            <tr><td>6</td><td>23</td><td>6</td><td>1</td></tr>
                            <tr><td>7</td><td>27</td><td>7</td><td>1</td></tr>
                            <tr><td>8</td><td>31</td><td>8</td><td>1</td></tr>
                        </tbody>
                    </table>
                </div>

                <button id="btnStart" class="btn-start" onclick="startGame()">üöÄ D√©marrer</button>
            </div>

            <!-- GAME -->
            <div id="gameScreen" class="screen">
                <div class="game-header">
                    <div style="color: #D4AF37; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Manche</div>
                    <div class="manche-counter" id="mancheDisplay">1</div>
                </div>
                <button class="turn-button" onclick="endTurn()">‚è±Ô∏è Fin de Manche</button>
            </div>

            <!-- END TURN -->
            <div id="endTurnScreen" class="screen">
                <div class="game-header">
                    <div style="color: #D4AF37; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">√âquipes</div>
                    <div class="manche-counter" id="mancheEndDisplay">1</div>
                </div>

                <div class="end-manche-section">
                    <div id="teamAssignment"></div>
                </div>

                <div class="winner-section">
                    <h3 style="color: #D4AF37; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">üé≠ Gagnant?</h3>
                    <div class="winner-buttons">
                        <button class="btn-winner blue" onclick="setWinner('blue')">üîµ Sherlock</button>
                        <button class="btn-winner red" onclick="setWinner('red')">üî¥ Moriarty</button>
                    </div>
                </div>
            </div>

            <!-- STATS -->
            <div id="statsScreen" class="screen">
                <div class="stats-section">
                    <h2 style="margin-bottom: 25px; font-size: 1.5rem; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; color: #D4AF37; font-weight: 500; text-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 0 0 30px rgba(42, 90, 90, 0.5), 0 0 45px rgba(255, 255, 255, 0.3);">üìä Histogramme</h2>
                    <div class="histogram-container" id="histogram"></div>

                    <h2 style="margin-top: 40px; margin-bottom: 25px; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px;">üìà Progression</h2>
                    <div id="progressionChart"></div>

                    <h2 style="margin-top: 40px; margin-bottom: 25px; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px;">üìã R√©sum√© des Manches</h2>
                    <div id="manchesSummary"></div>
                </div>

                <div class="control-buttons">
                    <button class="btn-action" id="continueBtn" onclick="nextManche()">‚ûú Manche Suivante</button>
                    <button class="btn-action btn-end" id="endBtn" onclick="endGame()">Fin du Jeu</button>
                </div>
            </div>

            <!-- MODAL SUPPRESSION MANCHE -->
            <div id="deleteConfirmModal">
                <div style="background: linear-gradient(135deg, #0a0a1a 0%, #1a2d3a 100%); border: 3px solid #D4AF37; border-radius: 12px; padding: 40px; max-width: 500px; text-align: center; box-shadow: 0 0 100px rgba(212, 175, 55, 0.5);">
                    <h2 style="color: #D4AF37; margin-bottom: 20px; font-size: 1.8rem; text-shadow: 0 0 15px rgba(212, 175, 55, 0.5);">‚ö†Ô∏è Supprimer la Manche?</h2>
                    <p style="color: #f5f5f0; margin-bottom: 30px; font-size: 1.1rem; line-height: 1.6;">Cette action est <strong>D√âFINITIVE</strong> et ne peut pas √™tre annul√©e.</p>
                    
                    <div style="display: flex; gap: 20px; justify-content: center;">
                        <button onclick="confirmDeleteManche()" style="background: linear-gradient(135deg, #FF4444 0%, #CC0000 100%); color: #fff; border: none; padding: 15px 40px; cursor: pointer; border-radius: 8px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; font-size: 1rem; box-shadow: 0 0 40px rgba(255, 68, 68, 0.6);">üóëÔ∏è OUI, SUPPRIMER</button>
                        <button onclick="cancelDeleteManche()" style="background: transparent; color: #D4AF37; border: 2px solid #D4AF37; padding: 13px 40px; cursor: pointer; border-radius: 8px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; font-size: 1rem;">‚ùå ANNULER</button>
                    </div>
                </div>
            </div>

            <!-- √âCRAN DE MODIFICATION MANCHE -->
            <div id="editMancheScreen" class="screen">
                <div style="position: relative; background: rgba(10, 10, 26, 0.9); border: 2px solid #D4AF37; padding: 30px; border-radius: 12px; box-shadow: 0 0 60px rgba(212, 175, 55, 0.5); max-width: 800px; margin: 50px auto;">
                    <h2 id="editMancheTitle" style="color: #D4AF37; text-align: center; margin-bottom: 30px; font-size: 1.5rem; text-shadow: 0 0 15px rgba(212, 175, 55, 0.5);">Modifier Manche</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <!-- √âQUIPE BLEU -->
                        <div style="background: rgba(58, 134, 255, 0.1); border: 2px solid rgba(58, 134, 255, 0.5); border-radius: 8px; padding: 20px;">
                            <h3 style="color: rgba(58, 134, 255, 0.9); margin-bottom: 20px; text-align: center; text-transform: uppercase; letter-spacing: 1px; font-weight: 900;">üîµ Sherlock</h3>
                            <div id="editBlueTeam" style="min-height: 200px; display: flex; flex-direction: column; gap: 10px; background: rgba(20, 20, 40, 0.5); padding: 10px; border-radius: 4px;">
                                <p style="color: rgba(58, 134, 255, 0.5); font-style: italic; text-align: center;">Aucun joueur...</p>
                            </div>
                        </div>
                        
                        <!-- √âQUIPE ROUGE -->
                        <div style="background: rgba(220, 20, 60, 0.1); border: 2px solid rgba(220, 20, 60, 0.5); border-radius: 8px; padding: 20px;">
                            <h3 style="color: rgba(220, 20, 60, 0.9); margin-bottom: 20px; text-align: center; text-transform: uppercase; letter-spacing: 1px; font-weight: 900;">üî¥ Moriarty</h3>
                            <div id="editRedTeam" style="min-height: 200px; display: flex; flex-direction: column; gap: 10px; background: rgba(20, 20, 40, 0.5); padding: 10px; border-radius: 4px;">
                                <p style="color: rgba(220, 20, 60, 0.5); font-style: italic; text-align: center;">Aucun joueur...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="saveEditManche()" style="background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%); color: #0a0a1a; border: none; padding: 12px 30px; cursor: pointer; border-radius: 8px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 0 40px rgba(212, 175, 55, 0.6);">‚úÖ Sauvegarder</button>
                        <button onclick="cancelEditManche()" style="background: transparent; color: #D4AF37; border: 2px solid #D4AF37; padding: 10px 30px; cursor: pointer; border-radius: 8px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px;">‚ùå Annuler</button>
                    </div>
                </div>
            </div>

            <!-- PODIUM -->
            <div id="podiumScreen" class="screen">
                <div style="text-align: center; margin-bottom: 50px;">
                    <h1 style="font-size: 2.8rem; font-weight: 900; color: #D4AF37; font-weight: 500; text-shadow: 0 0 30px rgba(255, 255, 255, 1), 0 0 60px rgba(42, 90, 90, 0.6), 0 0 90px rgba(255, 255, 255, 0.4); animation: titleSparkle 1.5s ease-in-out infinite; margin-bottom: 10px; letter-spacing: 2px;">üèÜ PODIUM FINAL üèÜ</h1>
                    <p style="color: #D4AF37; font-size: 1.1rem; animation: titleSparkle 1.5s ease-in-out infinite;">Partie Termin√©e!</p>
                </div>

                <div id="podium" style="display: flex; align-items: flex-end; justify-content: center; gap: 40px; margin: 60px 0; perspective: 1000px;"></div>

                <div style="text-align: center; margin-top: 50px;">
                    <button class="btn-action" onclick="resetGame()" style="width: auto; padding: 15px 40px; font-size: 1rem;">üîÑ NOUVELLE PARTIE</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== GESTION DES TH√àMES - D√âFINIR EN PREMIER =====
        
        function changeTheme(themeName) {
            console.log('Changing theme to:', themeName);

            // VIDER LE CACHE
            if (themeName === 'clearCache') {
                if (confirm('Vider TOUT le cache?\n\nTous les joueurs et parties seront supprim√©s!')) {
                    localStorage.clear();
                    location.reload();
                } else {
                    // Revenir au th√®me pr√©c√©dent
                    const savedTheme = localStorage.getItem('selectedTheme') || 'goldBomb';
                    document.getElementById('themeSelector').value = savedTheme;
                }
                return;
            }

            // V√©rifier que body existe
            if (!document.body) {
                console.warn('document.body not available, retrying in 50ms');
                setTimeout(() => changeTheme(themeName), 50);
                return;
            }

            // Si al√©atoire, g√©n√©rer vraies couleurs al√©atoires
            if (themeName === 'random') {
                generateRandomTheme();
                return;
            }

            // Enlever tous les th√®mes
            document.body.classList.remove('theme-goldBomb', 'theme-retrowave', 'theme-business', 'theme-cyberpunk', 'theme-random');

            // Ajouter le nouveau th√®me
            document.body.classList.add('theme-' + themeName);

            // Sauvegarder
            localStorage.setItem('selectedTheme', themeName);
            
            // Mettre √† jour le s√©lecteur si disponible
            const themeSelector = document.getElementById('themeSelector');
            if (themeSelector && themeSelector.value !== themeName) {
                themeSelector.value = themeName;
            }
            
            console.log('‚úÖ Theme changed to:', themeName);
        }

        function generateRandomTheme() {
            // V√©rifier que body existe
            if (!document.body) {
                console.warn('document.body not available, retrying in 50ms');
                setTimeout(generateRandomTheme, 50);
                return;
            }

            // G√©n√©rer 3 couleurs al√©atoires VIVES
            const hue1 = Math.floor(Math.random() * 360);
            const hue2 = (hue1 + 120 + Math.random() * 60) % 360;
            const hue3 = (hue1 + 240 + Math.random() * 60) % 360;

            // Couleurs tr√®s satur√©es et brillantes
            const color1 = `hsl(${hue1}, 100%, 55%)`;
            const color2 = `hsl(${hue2}, 100%, 55%)`;
            const color3 = `hsl(${hue3}, 100%, 55%)`;

            console.log('Generated random colors:', color1, color2, color3);

            // Appliquer le th√®me al√©atoire
            const root = document.documentElement;
            root.style.setProperty('--random-color1', color1);
            root.style.setProperty('--random-color2', color2);
            root.style.setProperty('--random-color3', color3);

            document.body.classList.remove('theme-goldBomb', 'theme-retrowave', 'theme-business', 'theme-cyberpunk');
            document.body.classList.add('theme-random');

            localStorage.setItem('selectedTheme', 'random');
            console.log('‚úÖ Random theme applied');
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'goldBomb';
            console.log('Initializing theme:', savedTheme);

            // Appliquer directement le th√®me sur le body
            if (savedTheme === 'random') {
                generateRandomTheme();
            } else {
                changeTheme(savedTheme);
            }

            // Attendre que themeSelector existe et le mettre √† jour
            const themeSelector = document.getElementById('themeSelector');
            if (themeSelector) {
                themeSelector.value = savedTheme === 'random' ? 'random' : savedTheme;
                console.log('‚úÖ themeSelector updated');
            } else {
                console.log('‚ö†Ô∏è themeSelector not available (will be set manually)');
            }
        }

        // Helper function pour acc√®s s√©curis√© √† classList
        function safeToggleClass(elementId, className, force) {
            const el = document.getElementById(elementId);
            if (el) el.classList.toggle(className, force);
        }

        function safeAddClass(elementId, className) {
            const el = document.getElementById(elementId);
            if (el) el.classList.add(className);
        }

        function safeRemoveClass(elementId, className) {
            const el = document.getElementById(elementId);
            if (el) el.classList.remove(className);
        }

        // ===== GAME STATE =====
        let gameState = {
            players: [],
            currentManche: 1,
            teamAssignment: {},
            mancheHistory: []
        };

        function saveGameData() {
            localStorage.setItem('timebombGameState', JSON.stringify(gameState));
        }

        function loadGameData() {
            const saved = localStorage.getItem('timebombGameState');
            if (saved) gameState = JSON.parse(saved);
        }

        function addPlayer() {
            const container = document.getElementById('playersInput');
            const div = document.createElement('div');
            div.className = 'player-input-group';
            div.innerHTML = `
                <input type="text" placeholder="Nom du joueur" class="player-input">
                <button class="btn-remove" onclick="removePlayer(this)">‚úï</button>
            `;
            container.appendChild(div);
            div.querySelector('input').focus();
            updateTableHighlight();
            updateButtonVisibility();
        }

        function removePlayer(btn) {
            btn.parentElement.remove();
            updateTableHighlight();
            updateButtonVisibility();
        }

        function updateTableHighlight() {
            const playerCount = document.querySelectorAll('.player-input').length;
            document.querySelectorAll('#setupTableBody tr').forEach(row => {
                row.classList.remove('highlight');
                if (parseInt(row.cells[0].textContent) === playerCount) {
                    row.classList.add('highlight');
                }
            });
        }

        function updateButtonVisibility() {
            const playerCount = document.querySelectorAll('.player-input').length;
            safeToggleClass('btnStart', 'visible', playerCount >= 4 && playerCount <= 8);
        }

        function startGame() {
            const inputs = document.querySelectorAll('.player-input');
            gameState.players = Array.from(inputs)
                .map(i => i.value.trim())
                .filter(n => n.length > 0);

            if (gameState.players.length < 4) {
                alert('Minimum 4 joueurs!');
                return;
            }

            gameState.currentManche = 1;
            gameState.mancheHistory = [];
            gameState.teamAssignment = {};
            gameState.players.forEach(p => {
                gameState.teamAssignment[p] = null;
            });

            document.getElementById('mancheDisplay').textContent = gameState.currentManche;
            switchScreen('gameScreen');
            saveGameData();
        }

        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const screen = document.getElementById(screenId);
            if (screen) screen.classList.add('active');
        }

        function endTurn() {
            document.getElementById('mancheEndDisplay').textContent = gameState.currentManche;
            renderTeamAssignment();
            switchScreen('endTurnScreen');
        }

        function renderTeamAssignment() {
            const container = document.getElementById('teamAssignment');
            container.innerHTML = '';
            gameState.players.forEach(player => {
                const selected = gameState.teamAssignment[player];
                const div = document.createElement('div');
                div.className = 'team-selector';
                div.innerHTML = `
                    <label>${player}</label>
                    <div class="team-toggle">
                        <button class="team-btn blue ${selected === 'blue' ? 'active' : ''}" onclick="assignTeam('${player}', 'blue')">üîµ</button>
                        <button class="team-btn red ${selected === 'red' ? 'active' : ''}" onclick="assignTeam('${player}', 'red')">üî¥</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function assignTeam(player, team) {
            gameState.teamAssignment[player] = team;
            renderTeamAssignment();
        }

        function setWinner(team) {
            const allAssigned = gameState.players.every(p => gameState.teamAssignment[p]);
            if (!allAssigned) {
                alert('Tous les joueurs doivent avoir une √©quipe!');
                return;
            }

            gameState.mancheHistory.push({
                manche: gameState.currentManche,
                assignments: {...gameState.teamAssignment},
                winner: team
            });

            renderStats();
            switchScreen('statsScreen');
            saveGameData();

            if (gameState.currentManche >= 4) {
                document.getElementById('continueBtn').style.display = 'none';
            }
        }

        function renderStats() {
            const playerStats = {};
            gameState.players.forEach(p => {
                playerStats[p] = [];
            });

            gameState.mancheHistory.forEach(round => {
                gameState.players.forEach(p => {
                    const team = round.assignments[p];
                    const won = round.winner === team;
                    playerStats[p].push({team, won, manche: round.manche});
                });
            });

            renderHistogram(playerStats);
            renderProgression(playerStats);
            renderManchesSummary();
        }

        function renderHistogram(playerStats) {
            const histogram = document.getElementById('histogram');
            histogram.innerHTML = '';

            gameState.players.forEach(player => {
                const stats = playerStats[player];
                let blueWin = 0, blueLost = 0, redWin = 0, redLost = 0, totalWins = 0;

                stats.forEach(s => {
                    if (s.team === 'blue') {
                        if (s.won) { blueWin++; totalWins++; }
                        else blueLost++;
                    } else if (s.team === 'red') {
                        if (s.won) { redWin++; totalWins++; }
                        else redLost++;
                    }
                });

                const total = blueWin + blueLost + redWin + redLost;

                let bar = '<div class="bar-vertical">';
                if (blueWin > 0) bar += `<div class="bar-segment segment-blue-win" style="flex: ${blueWin};">${blueWin}</div>`;
                if (blueLost > 0) bar += `<div class="bar-segment segment-blue-lost" style="flex: ${blueLost};">${blueLost}</div>`;
                if (redWin > 0) bar += `<div class="bar-segment segment-red-win" style="flex: ${redWin};">${redWin}</div>`;
                if (redLost > 0) bar += `<div class="bar-segment segment-red-lost" style="flex: ${redLost};">${redLost}</div>`;
                bar += '</div>';

                histogram.innerHTML += `
                    <div class="histogram-bar">
                        ${bar}
                        <div class="player-name-bar">
                            <div>${player}</div>
                            <div class="player-score">${totalWins}/${total}</div>
                        </div>
                    </div>
                `;
            });
        }

        function renderProgression(playerStats) {
            const progression = document.getElementById('progressionChart');
            progression.innerHTML = '';

            gameState.players.forEach(player => {
                const stats = playerStats[player];
                
                let totalWins = 0;
                stats.forEach(s => {
                    if (s.won) totalWins++;
                });
                
                const rankAbove = gameState.players.filter(p => {
                    let wins = 0;
                    playerStats[p].forEach(s => { if (s.won) wins++; });
                    return wins > totalWins;
                }).length;
                const rank = rankAbove + 1;
                
                const ranks = ['ü•á 1er', 'ü•à 2√®me', 'ü•â 3√®me', '4√®me', '5√®me', '6√®me', '7√®me', '8√®me'];
                const rankLabel = ranks[rank - 1] || rank + '√®me';

                let html = `<div class="progression-player">
                    <div class="progression-name">${player} <span style="color: #D4AF37; font-size: 0.9rem;">- ${rankLabel}</span></div>
                    <div class="progression-line">`;

                stats.forEach((s) => {
                    const roundWinner = gameState.mancheHistory.find(r => r.manche === s.manche).winner;
                    const playerWon = roundWinner === s.team;
                    
                    let emoji, type;
                    
                    if (playerWon) {
                        if (s.team === 'blue') {
                            emoji = '‚úÇÔ∏è';
                            type = 'blue-win';
                        } else {
                            emoji = 'üí£';
                            type = 'red-win';
                        }
                    } else {
                        emoji = 'üò≠';
                        type = s.team === 'blue' ? 'blue-lost' : 'red-lost';
                    }

                    html += `<div class="progression-manche">
                        <div class="manche-icon ${type}">${emoji}</div>
                        <div class="manche-number">M${s.manche}</div>
                    </div>`;
                });

                html += '</div></div>';
                progression.innerHTML += html;
            });
        }

        function renderManchesSummary() {
            const summary = document.getElementById('manchesSummary');
            let html = '<table class="summary-table"><thead><tr><th>Manche</th><th>üîµ</th><th>üî¥</th><th>Gagnant</th><th>Actions</th></tr></thead><tbody>';

            gameState.mancheHistory.forEach((round, idx) => {
                const blue = gameState.players.filter(p => round.assignments[p] === 'blue').join(', ');
                const red = gameState.players.filter(p => round.assignments[p] === 'red').join(', ');
                const winner = round.winner === 'blue' ? 'üîµ' : 'üî¥';
                const bgColor = round.winner === 'blue' ? 'rgba(58, 134, 255, 0.15)' : 'rgba(220, 20, 60, 0.15)';

                html += `<tr style="background: ${bgColor};">
                    <td>M${round.manche}</td>
                    <td>${blue}</td>
                    <td>${red}</td>
                    <td>${winner}</td>
                    <td>
                        <button class="btn-edit-manche" data-idx="${idx}" style="background: rgba(212, 175, 55, 0.7); color: #fff; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: 600; margin-right: 5px;">‚úèÔ∏è Modifier</button>
                        <button class="btn-delete-manche" data-idx="${idx}" style="background: rgba(220, 20, 60, 0.7); color: #fff; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: 600;">üóëÔ∏è Supprimer</button>
                    </td>
                </tr>`;
            });

            html += '</tbody></table>';
            summary.innerHTML = html;
            
            // Ajouter les event listeners apr√®s avoir g√©n√©r√© le HTML
            document.querySelectorAll('.btn-edit-manche').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = parseInt(e.currentTarget.dataset.idx);
                    console.log('Edit button clicked, idx:', idx, 'dataset:', e.currentTarget.dataset);
                    editManche(idx);
                });
            });
            
            document.querySelectorAll('.btn-delete-manche').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    console.log('Delete button clicked, e.currentTarget:', e.currentTarget);
                    console.log('Delete button dataset:', e.currentTarget.dataset);
                    const idx = parseInt(e.currentTarget.dataset.idx);
                    console.log('Parsed idx:', idx, 'type:', typeof idx);
                    e.preventDefault();
                    e.stopPropagation();
                    deleteManche(idx);
                });
            });
        }

        function editManche(idx) {
            console.log('Editing manche', idx);
            const round = gameState.mancheHistory[idx];
            console.log('Round:', round);
            console.log('Players:', gameState.players);
            
            window.currentEditIdx = idx;
            window.currentEditAssignments = {...round.assignments};
            
            document.getElementById('editMancheTitle').textContent = `Modifier Manche ${round.manche}`;
            updateEditDisplay();
            switchScreen('editMancheScreen');
        }

        function updateEditDisplay() {
            console.log('Updating display with assignments:', window.currentEditAssignments);
            const blueTeam = document.getElementById('editBlueTeam');
            const redTeam = document.getElementById('editRedTeam');
            
            if (!blueTeam || !redTeam) {
                console.error('Elements not found!');
                return;
            }
            
            blueTeam.innerHTML = '';
            redTeam.innerHTML = '';
            
            if (!gameState.players || gameState.players.length === 0) {
                console.error('No players found');
                return;
            }
            
            gameState.players.forEach(player => {
                const team = window.currentEditAssignments[player];
                console.log(`Player ${player} in team ${team}`);
                
                const btn = document.createElement('button');
                btn.style.cssText = `
                    padding: 12px;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 700;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    transition: all 0.3s;
                    background: ${team === 'blue' ? 'rgba(58, 134, 255, 0.8)' : 'rgba(220, 20, 60, 0.8)'};
                    color: #fff;
                `;
                
                btn.textContent = player;
                
                if (team === 'blue') {
                    btn.onclick = () => { 
                        console.log('Moving', player, 'to red');
                        movePlayer(player, 'red'); 
                    };
                    blueTeam.appendChild(btn);
                } else {
                    btn.onclick = () => { 
                        console.log('Moving', player, 'to blue');
                        movePlayer(player, 'blue'); 
                    };
                    redTeam.appendChild(btn);
                }
            });
        }

        function movePlayer(player, newTeam) {
            window.currentEditAssignments[player] = newTeam;
            updateEditDisplay();
        }

        function saveEditManche() {
            const idx = window.currentEditIdx;
            gameState.mancheHistory[idx].assignments = window.currentEditAssignments;
            renderStats();
            saveGameData();
            switchScreen('statsScreen');
        }

        function cancelEditManche() {
            switchScreen('statsScreen');
        }

        function deleteManche(idx) {
            console.log('deleteManche called with idx:', idx);
            
            if (idx < 0 || idx >= gameState.mancheHistory.length) {
                console.error('Invalid index:', idx);
                return;
            }
            
            // Stocker l'index globalement
            window.pendingDeleteIdx = idx;
            console.log('Showing delete confirmation modal for idx:', idx);
            
            // Afficher le modal
            const modal = document.getElementById('deleteConfirmModal');
            if (modal) modal.classList.add('modal-visible');
        }

        function confirmDeleteManche() {
            console.log('User confirmed deletion of idx:', window.pendingDeleteIdx);
            const idx = window.pendingDeleteIdx;
            
            gameState.mancheHistory.splice(idx, 1);
            console.log('‚úÖ Manche deleted! New length:', gameState.mancheHistory.length);
            
            renderStats();
            saveGameData();
            console.log('‚úÖ Stats rendered and data saved');
            
            // Fermer le modal
            const modal = document.getElementById('deleteConfirmModal');
            if (modal) modal.classList.remove('modal-visible');
        }

        function cancelDeleteManche() {
            console.log('User cancelled deletion');
            // Fermer le modal
            const modal = document.getElementById('deleteConfirmModal');
            if (modal) modal.classList.remove('modal-visible');
        }

        function nextManche() {
            gameState.currentManche++;
            gameState.teamAssignment = {};
            gameState.players.forEach(p => {
                gameState.teamAssignment[p] = null;
            });
            document.getElementById('mancheDisplay').textContent = gameState.currentManche;
            switchScreen('gameScreen');
            saveGameData();
        }

        function endGame() {
            renderPodium();
            switchScreen('podiumScreen');
            saveGameData();
        }

        function renderPodium() {
            const playerStats = {};
            gameState.players.forEach(p => {
                playerStats[p] = [];
            });

            gameState.mancheHistory.forEach(round => {
                gameState.players.forEach(p => {
                    const team = round.assignments[p];
                    const won = round.winner === team;
                    playerStats[p].push({team, won, manche: round.manche});
                });
            });

            // Calculer les classements
            const rankings = gameState.players.map(p => {
                let wins = 0;
                playerStats[p].forEach(s => { if (s.won) wins++; });
                return {name: p, wins};
            }).sort((a, b) => b.wins - a.wins);

            const podium = document.getElementById('podium');
            podium.innerHTML = '';

            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const positions = [
                {rank: 1, height: 220, offsetY: 0},
                {rank: 2, height: 160, offsetY: 60},
                {rank: 3, height: 100, offsetY: 120}
            ];

            positions.forEach((pos, idx) => {
                if (rankings[idx]) {
                    const player = rankings[idx];
                    const medal = medals[idx] || 'üéñÔ∏è';
                    
                    const podiumDiv = document.createElement('div');
                    podiumDiv.style.cssText = `
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        gap: 20px;
                        animation: podiumBounce 2s ease-in-out infinite;
                        animation-delay: ${idx * 0.2}s;
                    `;
                    
                    const platform = document.createElement('div');
                    platform.style.cssText = `
                        background: linear-gradient(135deg, #D4AF37 0%, #D4AF37 100%);
                        width: 120px;
                        height: ${pos.height}px;
                        border-radius: 8px 8px 0 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 
                            0 0 30px rgba(42, 90, 90, 0.8),
                            0 0 120px rgba(212, 175, 55, 0.5),
                            inset 0 0 20px rgba(255, 255, 255, 0.3);
                        font-size: 2.5rem;
                        font-weight: 900;
                        color: #fff;
                        text-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
                        animation: platformGlow 2s ease-in-out infinite;
                        animation-delay: ${idx * 0.2}s;
                    `;
                    platform.textContent = pos.rank;
                    
                    const info = document.createElement('div');
                    info.style.cssText = `
                        text-align: center;
                        color: #D4AF37; font-weight: 500;
                    `;
                    info.innerHTML = `
                        <div style="font-size: 2rem; margin-bottom: 8px;">${medal}</div>
                        <div style="font-size: 1.2rem; font-weight: 900; color: #D4AF37; text-shadow: 0 0 10px rgba(42, 90, 90, 0.8);">${player.name}</div>
                        <div style="font-size: 1rem; color: #D4AF37; margin-top: 5px;">${player.wins} victoire${player.wins > 1 ? 's' : ''}</div>
                    `;
                    
                    podiumDiv.appendChild(platform);
                    podiumDiv.appendChild(info);
                    podium.appendChild(podiumDiv);
                }
            });
        }

        function goToStats() {
            renderStats();
            switchScreen('statsScreen');
        }

        function resetGame() {
            gameState = {players: [], currentManche: 1, teamAssignment: {}, mancheHistory: []};
            localStorage.removeItem('timebombGameState');
            location.reload();
        }

        function continueSavedGame() {
            location.reload();
        }

        function clearSavedGame() {
            if (confirm('√ätes-vous s√ªr? Cela supprimera la partie sauvegard√©e.')) {
                localStorage.removeItem('timebombGameState');
                const alert = document.getElementById('savedGameAlert');
                if (alert) {
                    alert.classList.add('saved-game-disabled');
                    alert.classList.remove('saved-game-enabled');
                }
                const details = document.getElementById('savedGameDetails');
                if (details) details.innerHTML = 'Aucune partie sauvegard√©e. Cr√©e une nouvelle partie pour commencer!';
                gameState = {players: [], currentManche: 1, teamAssignment: {}, mancheHistory: []};
                const input = document.getElementById('playersInput');
                if (input) input.innerHTML = '';
                updateButtonVisibility();
            }
        }

        function checkSavedGame() {
            const saved = localStorage.getItem('timebombGameState');
            const alert = document.getElementById('savedGameAlert');
            const details = document.getElementById('savedGameDetails');
            
            if (saved && alert && details) {
                const data = JSON.parse(saved);
                if (data.players && data.players.length > 0) {
                    // Partie sauvegard√©e trouv√©e
                    alert.classList.remove('saved-game-disabled');
                    alert.classList.add('saved-game-enabled');
                    
                    let detailsHTML = `
                        <div style="margin-bottom: 10px;">üë• <strong style="color: #D4AF37;">${data.players.length} JOUEURS:</strong> ${data.players.join(' ‚Ä¢ ')}</div>
                        <div style="margin-bottom: 10px;">üìç <strong style="color: #D4AF37;">PROGRESSION:</strong> Manche ${data.currentManche}/4</div>
                        <div style="margin-bottom: 10px;">üéÆ <strong style="color: #D4AF37;">MANCHES JOU√âES:</strong> ${data.mancheHistory.length}</div>
                    `;
                    
                    if (data.mancheHistory.length > 0) {
                        const blueWins = data.mancheHistory.filter(m => m.winner === 'blue').length;
                        const redWins = data.mancheHistory.filter(m => m.winner === 'red').length;
                        detailsHTML += `<div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #D4AF37; display: flex; justify-content: space-around; gap: 20px;">
                            <div><span style="color: #D4AF37; font-weight: 900; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8); font-size: 1.1rem;">üîµ SHERLOCK:</span> <strong style="color: #D4AF37; font-size: 1.1rem;">${blueWins}V</strong></div>
                            <div><span style="color: #D4AF37; font-weight: 900; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8); font-size: 1.1rem;">üî¥ MORIARTY:</span> <strong style="color: #D4AF37; font-size: 1.1rem;">${redWins}V</strong></div>
                        </div>`;
                    }
                    
                    details.innerHTML = detailsHTML;
                    return;
                }
            }
            
            // Aucune partie sauvegard√©e
            if (alert) {
                alert.classList.add('saved-game-disabled');
                alert.classList.remove('saved-game-enabled');
            }
            if (details) details.innerHTML = 'Aucune partie sauvegard√©e. Cr√©e une nouvelle partie pour commencer!';
        }

        // ===== GESTION DES TH√àMES =====
        
        const themes = {
            goldBomb: { name: 'üîîüí£ Gold Bomb (Big Ben)', label: 'goldBomb' },
            retrowave: { name: 'üåä Retrowave (Glam 80s)', label: 'retrowave' },
            business: { name: 'üíº Business (Marron/Argent)', label: 'business' },
            cyberpunk: { name: 'ü§ñ Cyberpunk (Futuriste)', label: 'cyberpunk' },
            random: { name: 'üé≤ Al√©atoire', label: 'random' }
        };

        window.addEventListener('DOMContentLoaded', () => {
            initTheme();
            loadGameData();
            updateButtonVisibility();
            checkSavedGame();
            
            if (gameState.players.length > 0) {
                const allAssigned = gameState.players.every(p => gameState.teamAssignment[p] !== null);
                
                if (allAssigned && gameState.mancheHistory.length > 0) {
                    renderStats();
                    switchScreen('statsScreen');
                } else if (!allAssigned && gameState.mancheHistory.length > 0) {
                    switchScreen('gameScreen');
                    document.getElementById('mancheDisplay').textContent = gameState.currentManche;
                } else {
                    switchScreen('gameScreen');
                    document.getElementById('mancheDisplay').textContent = gameState.currentManche;
                }
            } else {
                // Au d√©marrage ou si pas de joueurs: afficher l'√©cran de setup
                switchScreen('setupScreen');
            }
        });
    </script>
</body>
</html>